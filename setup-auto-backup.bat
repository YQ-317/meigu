@echo off
chcp 65001 > nul
echo ========================================
echo   è‡ªåŠ¨å¤‡ä»½ä»»åŠ¡è®¾ç½®å·¥å…·
echo   Auto Backup Task Setup Tool
echo ========================================
echo.

REM èŽ·å–å½“å‰è„šæœ¬æ‰€åœ¨ç›®å½•
set "SCRIPT_DIR=%~dp0"

REM èŽ·å– backup-database.bat çš„å®Œæ•´è·¯å¾„
set "BACKUP_SCRIPT=%SCRIPT_DIR%backup-database.bat"

echo ðŸ“‹ è®¾ç½®ä¿¡æ¯
echo ----------------------------------------
echo å¤‡ä»½è„šæœ¬: %BACKUP_SCRIPT%
echo å¤‡ä»½ç›®å½•: %SCRIPT_DIR%backups
echo ä»»åŠ¡è®¡åˆ’åç§°: ä¸œæ–¹ç¾Žè°·æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½
echo æ‰§è¡Œé¢‘çŽ‡: æ¯å¤©å‡Œæ™¨2ç‚¹
echo ä¿ç•™å¤©æ•°: 30å¤©
echo ----------------------------------------
echo.
echo æ­£åœ¨åˆ›å»ºä»»åŠ¡è®¡åˆ’...
echo.

REM åˆ›å»ºä»»åŠ¡è®¡åˆ’ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œï¼‰
schtasks /create /tn "ä¸œæ–¹ç¾Žè°·æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½" /tr "%BACKUP_SCRIPT%" /sc daily /st 02:00 /f 2>nul

if %errorlevel% equ 0 (
    echo.
    echo âœ… è‡ªåŠ¨å¤‡ä»½ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼
    echo ----------------------------------------
    echo ä»»åŠ¡è®¡åˆ’å·²è®¾ç½®ï¼š
    echo - ä»»åŠ¡åç§°ï¼šä¸œæ–¹ç¾Žè°·æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½
    echo - æ‰§è¡Œæ—¶é—´ï¼šæ¯å¤©å‡Œæ™¨2:00
    echo - æ‰§è¡Œè„šæœ¬ï¼š%BACKUP_SCRIPT%
    echo ----------------------------------------
    echo.
    echo æŸ¥çœ‹ä»»åŠ¡ï¼š
    echo 1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº"ï¼ˆtaskschd.mscï¼‰
    echo 2. æ‰¾åˆ°"ä¸œæ–¹ç¾Žè°·æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½"ä»»åŠ¡
    echo 3. å¯ä»¥å³é”®ä¿®æ”¹æ‰§è¡Œæ—¶é—´
    echo.
    echo åˆ é™¤ä»»åŠ¡ï¼š
    echo schtasks /delete /tn "ä¸œæ–¹ç¾Žè°·æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½" /f
    echo.
) else (
    echo.
    echo âŒ ä»»åŠ¡åˆ›å»ºå¤±è´¥ï¼
    echo ----------------------------------------
    echo è¯·ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œæ­¤è„šæœ¬ï¼
    echo.
    echo æ‰‹åŠ¨åˆ›å»ºä»»åŠ¡è®¡åˆ’ï¼š
    echo 1. æŒ‰ Win+Rï¼Œè¾“å…¥ taskschd.msc
    echo 2. åˆ›å»ºåŸºæœ¬ä»»åŠ¡
    echo 3. åç§°ï¼šä¸œæ–¹ç¾Žè°·æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½
    echo 4. è§¦å‘å™¨ï¼šæ¯å¤©ï¼Œå‡Œæ™¨2:00
    echo 5. æ“ä½œï¼šå¯åŠ¨ç¨‹åº
    echo 6. ç¨‹åºï¼š%BACKUP_SCRIPT%
    echo ----------------------------------------
    echo.
)

echo ========================================
echo è®¾ç½®å®Œæˆï¼æŒ‰ä»»æ„é”®é€€å‡º...
echo ========================================
pause > nul

