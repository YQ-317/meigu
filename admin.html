<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°ç®¡ç†ç³»ç»Ÿ - ä¸œæ–¹ç¾è°·éŸ©å›½ä¸­å¿ƒ</title>
    <link rel="icon" type="image/png" href="images/logo.jpg">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- SheetJS åº“ç”¨äºå¯¼å‡º Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        /* ç®€çº¦åå°ç®¡ç†æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: #f5f6fa;
            color: #333;
        }

        .admin-container {
            min-height: 100vh;
            background: #f5f6fa;
            padding: 20px;
        }

        .admin-header {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #667eea;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            flex: 0 0 auto;
        }

        .header-center {
            flex: 1;
            text-align: center;
        }

        .header-right {
            flex: 0 0 auto;
        }

        .company-logo {
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 6px;
        }

        .company-logo:hover {
            background: #f8f9fa;
            transform: scale(1.05);
        }

        .company-logo .logo-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            object-fit: cover;
        }

        .company-logo .logo-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .admin-header h1 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .admin-header p {
            color: #666;
            font-size: 1rem;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        /* æƒé™ç³»ç»Ÿæ ·å¼ */
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-right: 20px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: #666;
            padding: 2px 8px;
            border-radius: 10px;
            background: #f0f0f0;
            width: fit-content;
        }

        .user-role.super-admin {
            background: #ff6b6b;
            color: white;
        }

        .user-role.admin {
            background: #4ecdc4;
            color: white;
        }

        .user-role.user {
            background: #95a5a6;
            color: white;
        }

        /* æ—¥å¿—æŸ¥çœ‹å™¨æ ·å¼ */
        .log-viewer {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
            width: 100%;
            min-height: 400px;
            height: auto;
            display: block;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .log-filters {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .log-filter {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .log-filter:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .log-filter.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .log-list {
            max-height: 500px;
            min-height: 200px;
            height: auto;
            width: 100%;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            background: white;
        }

        .log-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: background 0.3s ease;
        }

        .log-item:hover {
            background: #f8f9fa;
        }

        .log-item:last-child {
            border-bottom: none;
        }

        .log-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .log-icon.create {
            background: #28a745;
        }

        .log-icon.update {
            background: #ffc107;
        }

        .log-icon.delete {
            background: #dc3545;
        }

        .log-content {
            flex: 1;
        }

        .log-action {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .log-details {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 2px;
        }

        .log-time {
            font-size: 0.8rem;
            color: #999;
        }

        .log-user {
            font-size: 0.85rem;
            color: #667eea;
            font-weight: 500;
        }

        .empty-logs {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-logs i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-top: 3px solid #667eea;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* æ ‡ç­¾é¡µæ ·å¼ */
        .admin-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .tab-btn {
            flex: 1;
            background: white;
            border: none;
            padding: 20px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover {
            background: #f8f9fa;
            color: #333;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #f8f9fa;
        }

        .tab-btn i {
            margin-right: 8px;
        }

        .admin-main {
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-card {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: none;
        }

        .admin-card.active {
            display: block;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .card-title {
            font-size: 1.3rem;
            color: #333;
            font-weight: 600;
        }

        .add-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .add-btn:hover {
            background: #5a6fd8;
        }

        .content-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 50px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .admin-article-item {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 1px solid #f0f0f0;
            padding: 20px 25px;
        }

        .admin-article-item:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
            border-color: #ff6900;
        }

        .article-link-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .article-link-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
        }

        .article-link-category {
            background: #ff6900;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .article-link-date {
            color: #999;
            font-size: 0.9rem;
        }



        .article-link-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            line-height: 1.4;
            transition: color 0.3s ease;
        }

        .admin-article-item:hover .article-link-title {
            color: #ff6900;
        }


        .article-link-desc {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .article-link-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        .article-link-actions .action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            gap: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
        }

        .article-link-actions .edit-btn {
            background: #667eea;
            color: white;
        }

        .article-link-actions .edit-btn:hover {
            background: #5a6fd8;
        }

        .article-link-actions .delete-btn {
            background: #e74c3c;
            color: white;
        }

        .article-link-actions .delete-btn:hover {
            background: #c0392b;
        }

        .article-link-actions .view-btn {
            background: #27ae60;
            color: white;
        }

        .article-link-actions .view-btn:hover {
            background: #229954;
        }

        /* å›¾ç‰‡å’Œè§†é¢‘é¢„è§ˆæ ·å¼ */
        .image-preview,
        .video-preview {
            margin-top: 10px;
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            overflow: hidden;
            display: none;
        }

        .image-preview img,
        .video-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview.show,
        .video-preview.show {
            display: block;
        }

        /* æ–°é—»è¯¦æƒ…æ ·å¼ */
        .news-details {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .news-detail-item {
            margin-bottom: 8px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .news-detail-item:last-child {
            margin-bottom: 0;
        }

        .news-detail-item strong {
            color: #333;
            margin-right: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ddd;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #666;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-title {
            font-size: 1.3rem;
            color: #333;
            margin: 0;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 5px;
        }

        .modal-close:hover {
            color: #333;
        }

        .modal-body {
            margin-bottom: 25px;
        }

        /* ç»Ÿä¸€æ¨¡æ€æ¡†å†…è¡¨å•æ§ä»¶æ ·å¼ */
        .modal-body .form-group {
            margin-bottom: 16px;
        }

        .modal-body .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .modal-body input[type="text"],
        .modal-body input[type="url"],
        .modal-body input[type="date"],
        .modal-body input[type="time"],
        .modal-body input[type="file"],
        .modal-body select,
        .modal-body textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .modal-footer {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .admin-container {
                padding: 15px;
            }

            .admin-header {
                padding: 20px;
                flex-direction: column;
                gap: 20px;
            }

            .header-left,
            .header-center,
            .header-right {
                flex: none;
                width: 100%;
            }

            .header-center {
                order: 1;
            }

            .header-left {
                order: 2;
                text-align: center;
            }

            .header-right {
                order: 3;
                text-align: center;
            }

            .admin-header h1 {
                font-size: 1.5rem;
            }

            .company-logo {
                justify-content: center;
            }

            .logout-btn {
                width: 100%;
                max-width: 200px;
            }

            .admin-tabs {
                flex-direction: column;
            }

            .tab-btn {
                border-bottom: none;
                border-right: 3px solid transparent;
            }

            .tab-btn.active {
                border-bottom: none;
                border-right-color: #667eea;
            }

            .admin-card {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                max-width: 300px;
            }

            .content-list {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .item-image {
                height: 150px;
            }

            .item-content-wrapper {
                padding: 15px;
            }

            .item-title {
                font-size: 1.1rem;
            }

            .item-actions {
                justify-content: flex-start;
                flex-wrap: wrap;
            }

            .modal-content {
                padding: 20px;
            }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .content-list::-webkit-scrollbar {
            width: 6px;
        }

        .content-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .content-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .content-list::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* é€šçŸ¥æ ·å¼ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            max-width: 300px;
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.warning {
            background: #ffc107;
            color: #333;
        }

        .notification.info {
            background: #17a2b8;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <!-- ç®¡ç†ç•Œé¢ -->
        <div id="adminSection">
            <!-- å¤´éƒ¨ -->
            <div class="admin-header">
                <div class="header-left">
                    <div class="company-logo" onclick="goToHome()">
                        <img src="images/logo.jpg" alt="ä¸œæ–¹ç¾è°·" class="logo-img">
                        <span class="logo-text">ä¸œæ–¹ç¾è°·</span>
                    </div>
                </div>
                <div class="header-center">
                    <h1><i class="fas fa-cogs"></i> åå°ç®¡ç†ç³»ç»Ÿ</h1>
                    <p>ä¸œæ–¹ç¾è°·éŸ©å›½ä¸­å¿ƒ - å†…å®¹ç®¡ç†ä¸­å¿ƒ</p>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">A</div>
                        <div class="user-details">
                            <div class="user-name" id="userName">ç®¡ç†å‘˜</div>
                            <div class="user-role" id="userRole">admin</div>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="manualRefreshPermissions()"
                        style="background: #28a745; margin-right: 10px;" title="ä»æ•°æ®åº“åˆ·æ–°æƒé™">
                        <i class="fas fa-sync-alt"></i> åˆ·æ–°æƒé™
                    </button>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•
                    </button>
                </div>
            </div>

            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="articleCount">0</div>
                    <div class="stat-label">æ–‡ç« æ€»æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="newsCount">0</div>
                    <div class="stat-label">æ–°é—»æ€»æ•°</div>
                </div>
            </div>

            <!-- ç®¡ç†æ ‡ç­¾é¡µ -->
            <div class="admin-tabs">
                <button class="tab-btn active" data-tab="articles" onclick="switchTab('articles')">
                    <i class="fas fa-file-alt"></i>
                    <span>æ–‡ç« ç®¡ç†</span>
                </button>
                <button class="tab-btn" data-tab="news" onclick="switchTab('news')">
                    <i class="fas fa-newspaper"></i>
                    <span>æ–°é—»ç®¡ç†</span>
                </button>
                <button class="tab-btn" data-tab="activities" onclick="switchTab('activities')" id="activitiesTabBtn"
                    style="display: none;">
                    <i class="fas fa-calendar-alt"></i>
                    <span>æ´»åŠ¨å±•ç¤º</span>
                </button>
                <button class="tab-btn" data-tab="logs" onclick="switchTab('logs')" id="logsTabBtn"
                    style="display: none;">
                    <i class="fas fa-history"></i>
                    <span>æ“ä½œæ—¥å¿—</span>
                </button>
            </div>

            <!-- ä¸»è¦å†…å®¹ -->
            <div class="admin-main">
                <!-- æ–‡ç« ç®¡ç† -->
                <div class="admin-card active" id="articlesTab">
                    <div class="card-header">
                        <h3 class="card-title">æ–‡ç« ç®¡ç†</h3>
                        <button class="add-btn" onclick="openArticleModal()">
                            <i class="fas fa-plus"></i> æ·»åŠ æ–‡ç« 
                        </button>
                    </div>
                    <div class="content-list" id="articlesList">
                        <div class="empty-state">
                            <i class="fas fa-file-alt"></i>
                            <h3>æš‚æ— æ–‡ç« </h3>
                            <p>ç‚¹å‡»"æ·»åŠ æ–‡ç« "å¼€å§‹åˆ›å»ºå†…å®¹</p>
                        </div>
                    </div>
                </div>

                <!-- æ–°é—»ç®¡ç† -->
                <div class="admin-card" id="newsTab">
                    <div class="card-header">
                        <h3 class="card-title">æ–°é—»ç®¡ç†</h3>
                        <button class="add-btn" onclick="openNewsModal()">
                            <i class="fas fa-plus"></i> æ·»åŠ æ–°é—»
                        </button>
                    </div>
                    <div class="content-list" id="newsList">
                        <div class="empty-state">
                            <i class="fas fa-newspaper"></i>
                            <h3>æš‚æ— æ–°é—»</h3>
                            <p>ç‚¹å‡»"æ·»åŠ æ–°é—»"å¼€å§‹åˆ›å»ºå†…å®¹</p>
                        </div>
                    </div>
                </div>

                <!-- æ´»åŠ¨å±•ç¤º -->
                <div class="admin-card" id="activitiesTab">
                    <div class="card-header">
                        <h3 class="card-title">æ´»åŠ¨å±•ç¤º</h3>
                        <p style="color: #666; font-size: 0.9rem;">ç‚¹å‡»æ´»åŠ¨å¡ç‰‡å¯è·³è½¬åˆ°è¯¦æƒ…é¡µ</p>
                    </div>
                    <div class="content-list" id="activitiesList"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                        <div class="empty-state">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>æš‚æ— æ´»åŠ¨</h3>
                            <p>åœ¨"æ–°é—»ç®¡ç†"ä¸­æ·»åŠ æ´»åŠ¨</p>
                        </div>
                    </div>
                </div>

                <!-- æ“ä½œæ—¥å¿— -->
                <div class="admin-card" id="logsTab">
                    <div class="log-viewer">
                        <div class="log-header">
                            <h3 class="card-title">æ“ä½œæ—¥å¿—</h3>
                            <div style="display: flex; gap: 10px;">
                                <button class="add-btn" onclick="refreshLogs()" style="background: #28a745;">
                                    <i class="fas fa-sync-alt"></i> åˆ·æ–°æ—¥å¿—
                                </button>
                                <button class="add-btn" onclick="clearLogs()">
                                    <i class="fas fa-trash"></i> æ¸…ç©ºæ—¥å¿—
                                </button>
                            </div>
                        </div>

                        <!-- æ•°æ®å¯¼å‡ºåŠŸèƒ½ -->
                        <div class="export-section"
                            style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                            <h4 style="margin-bottom: 15px; color: #333;">
                                <i class="fas fa-download"></i> æ•°æ®å¯¼å‡º
                            </h4>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="add-btn" onclick="exportNewsToExcel()" style="background: #17a2b8;">
                                    <i class="fas fa-file-excel"></i> å¯¼å‡ºæ–°é—»åˆ°Excel
                                </button>
                                <button class="add-btn" onclick="exportArticlesToExcel()" style="background: #6f42c1;">
                                    <i class="fas fa-file-excel"></i> å¯¼å‡ºæ–‡ç« åˆ°Excel
                                </button>
                                <button class="add-btn" onclick="exportAllData()" style="background: #fd7e14;">
                                    <i class="fas fa-database"></i> å¯¼å‡ºæ‰€æœ‰æ•°æ®
                                </button>
                            </div>
                        </div>

                        <div class="log-filters">
                            <button class="log-filter active" onclick="filterLogs('all')">å…¨éƒ¨</button>
                            <button class="log-filter" onclick="filterLogs('create')">åˆ›å»º</button>
                            <button class="log-filter" onclick="filterLogs('update')">ä¿®æ”¹</button>
                            <button class="log-filter" onclick="filterLogs('delete')">åˆ é™¤</button>
                        </div>

                        <div class="log-list" id="logList">
                            <div class="empty-logs">
                                <i class="fas fa-history"></i>
                                <h3>æš‚æ— æ“ä½œè®°å½•</h3>
                                <p>ç³»ç»Ÿå°†è‡ªåŠ¨è®°å½•æ‰€æœ‰æ“ä½œ</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡ç« æ¨¡æ€æ¡† -->
    <div id="articleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="articleModalTitle">æ·»åŠ æ–‡ç« </h3>
            </div>
            <div class="modal-body">
                <form id="articleForm">
                    <div class="form-group">
                        <label for="articleTitle">æ–‡ç« æ ‡é¢˜ *</label>
                        <input type="text" id="articleTitle" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="articleContent">æ–‡ç« å†…å®¹ *</label>
                        <textarea id="articleContent" name="content" rows="4" required
                            style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="articleLink">æ–‡ç« é“¾æ¥ *</label>
                        <input type="url" id="articleLink" name="link" required
                            placeholder="https://mp.weixin.qq.com/s/...">
                    </div>
                    <div class="form-group">
                        <label for="articleCategory">æ–‡ç« åˆ†ç±» *</label>
                        <select id="articleCategory" name="category" required
                            style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                            <option value="">è¯·é€‰æ‹©åˆ†ç±»</option>
                            <option value="ä¸­éŸ©æ–°è±¡">ä¸­éŸ©æ–°è±¡</option>
                            <option value="è¶‹åŠ¿å‰ç»">è¶‹åŠ¿å‰ç»</option>
                            <option value="ç¾è°·éŸ©è®¯">ç¾è°·éŸ©è®¯</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="articleDate">å‘å¸ƒæ—¥æœŸ *</label>
                        <input type="date" id="articleDate" name="date" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('articleModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveArticle()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- æ–°é—»æ¨¡æ€æ¡† -->
    <div id="newsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="newsModalTitle">æ·»åŠ æ–°é—»</h3>
            </div>
            <div class="modal-body">
                <form id="newsForm">
                    <div class="form-group">
                        <label for="newsTitle">æ–°é—»æ ‡é¢˜ *</label>
                        <input type="text" id="newsTitle" name="title" required placeholder="è¯·è¾“å…¥æ´»åŠ¨æ ‡é¢˜">
                    </div>
                    <div class="form-group">
                        <label for="newsSubtitle">å‰¯æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" id="newsSubtitle" name="subtitle" placeholder="å¦‚ï¼šä¸­éŸ©åˆä½œæ–°ç¯‡ç« ã€æ–°æ—¶ä»£ç¾å¦†äº§ä¸šå‘å±•ç­‰">
                        <small style="color: #999; font-size: 0.9rem;">ç®€çŸ­æè¿°ï¼Œå°†åœ¨æ ‡é¢˜ä¸‹æ–¹æ˜¾ç¤º</small>
                    </div>
                    <div class="form-group">
                        <label for="newsContent">æ–°é—»å†…å®¹ *</label>
                        <textarea id="newsContent" name="content" rows="4" required
                            style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"
                            placeholder="è¯¦ç»†æè¿°æ´»åŠ¨å†…å®¹ã€æµç¨‹å’ŒèƒŒæ™¯"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="newsDate">æ´»åŠ¨æ—¶é—´ *</label>
                        <input type="date" id="newsDate" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="newsTime">å…·ä½“æ—¶é—´</label>
                        <input type="time" id="newsTime" name="time" placeholder="09:00-17:00">
                    </div>
                    <div class="form-group">
                        <label for="newsLocation">æ´»åŠ¨åœ°ç‚¹ *</label>
                        <input type="text" id="newsLocation" name="location" required placeholder="ä¸Šæµ·å¸‚å¥‰è´¤åŒºä¸œæ–¹ç¾è°·å¤§é“1699å·">
                    </div>
                    <div class="form-group">
                        <label for="newsOrganizer">ä¸»åŠæ–¹ *</label>
                        <input type="text" id="newsOrganizer" name="organizer" required placeholder="ä¸œæ–¹ç¾è°·éŸ©å›½ä¸­å¿ƒ">
                    </div>
                    <div class="form-group">
                        <label for="newsCoOrganizer">è”åˆç»„ç»‡è€…</label>
                        <input type="text" id="newsCoOrganizer" name="coOrganizer" placeholder="åˆä½œä¼™ä¼´åç§°">
                    </div>
                    <div class="form-group">
                        <label for="newsCoreFunction">æ ¸å¿ƒåŠŸèƒ½ *</label>
                        <textarea id="newsCoreFunction" name="coreFunction" rows="3" required
                            style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"
                            placeholder="æè¿°æ´»åŠ¨çš„æ ¸å¿ƒåŠŸèƒ½å’Œç›®æ ‡"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="newsHighlights">æ´»åŠ¨äº®ç‚¹ *</label>
                        <textarea id="newsHighlights" name="highlights" rows="3" required
                            style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"
                            placeholder="æè¿°æ´»åŠ¨çš„äº®ç‚¹å’Œç‰¹è‰²"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="newsEventGoal">æ´»åŠ¨ç›®æ ‡</label>
                        <textarea id="newsEventGoal" name="eventGoal" rows="3"
                            style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"
                            placeholder="æè¿°æ´»åŠ¨çš„ç›®æ ‡å’Œæ„¿æ™¯"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="newsParticipants">é¢„æœŸäººæ•°</label>
                        <input type="text" id="newsParticipants" name="participants" placeholder="å¦‚ï¼š100-200äºº">
                    </div>
                    <div class="form-group">
                        <label for="newsEventScale">æ´»åŠ¨è§„æ¨¡</label>
                        <select id="newsEventScale" name="eventScale"
                            style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="å¤§å‹æ´»åŠ¨">å¤§å‹æ´»åŠ¨ï¼ˆ500äººä»¥ä¸Šï¼‰</option>
                            <option value="ä¸­å‹æ´»åŠ¨">ä¸­å‹æ´»åŠ¨ï¼ˆ100-500äººï¼‰</option>
                            <option value="å°å‹æ´»åŠ¨">å°å‹æ´»åŠ¨ï¼ˆ50-100äººï¼‰</option>
                            <option value="ç²¾å“æ´»åŠ¨">ç²¾å“æ´»åŠ¨ï¼ˆ50äººä»¥ä¸‹ï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newsEventFee">æ´»åŠ¨è´¹ç”¨</label>
                        <input type="text" id="newsEventFee" name="eventFee" placeholder="å¦‚ï¼šå…è´¹ / ï¿¥100/äºº">
                    </div>
                    <div class="form-group">
                        <label for="newsCategory">æ–°é—»åˆ†ç±»</label>
                        <select id="newsCategory" name="category"
                            style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                            <option value="æ´»åŠ¨æ–°é—»">æ´»åŠ¨æ–°é—»</option>
                            <option value="å…¬å¸åŠ¨æ€">å…¬å¸åŠ¨æ€</option>
                            <option value="è¡Œä¸šèµ„è®¯">è¡Œä¸šèµ„è®¯</option>
                            <option value="äº§å“å‘å¸ƒ">äº§å“å‘å¸ƒ</option>
                            <option value="åˆä½œç­¾çº¦">åˆä½œç­¾çº¦</option>
                            <option value="å±•ä¼šæ´»åŠ¨">å±•ä¼šæ´»åŠ¨</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newsCoverImage">å°é¢å›¾ç‰‡ï¼ˆé¦–é¡µå±•ç¤ºç”¨ï¼Œä¸æ˜¾ç¤ºåœ¨è¯¦æƒ…é¡µï¼‰</label>
                        <input type="file" id="newsCoverImage" name="coverImage" accept="image/*"
                            onchange="previewCover(this, 'newsCoverImagePreview')">
                        <small style="color: #666;">ç”¨äºåœ¨é¦–é¡µå’Œåˆ—è¡¨é¡µæ˜¾ç¤ºï¼Œå»ºè®®å°ºå¯¸ï¼š1200x600px</small>
                        <small style="color: #4299E1; display: block; margin-top: 5px;">ğŸ’¡
                            æ”¯æŒä¸Šä¼ æœ€å¤§2MBçš„å›¾ç‰‡ï¼ˆå»ºè®®1MBä»¥å†…ä»¥è·å¾—æœ€ä½³æ€§èƒ½ï¼‰</small>
                        <div id="newsCoverImagePreview" class="image-preview" style="margin-top: 10px;"></div>
                    </div>
                    <div class="form-group">
                        <label for="newsImage">æ´»åŠ¨å›¾ç‰‡ï¼ˆå¯ä¸Šä¼ å¤šå¼ ï¼‰</label>
                        <input type="file" id="newsImage" name="image" accept="image/*" multiple
                            onchange="previewImages(this, 'newsImagePreview')">
                        <small style="color: #666;">åœ¨æ´»åŠ¨è¯¦æƒ…é¡µå±•ç¤ºï¼Œå¯ä¸Šä¼ å¤šå¼ </small>
                        <div id="newsImagePreview" class="image-preview"
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newsVideo">æ´»åŠ¨è§†é¢‘ï¼ˆå¯ä¸Šä¼ å¤šä¸ªï¼‰</label>
                        <input type="file" id="newsVideo" name="video" accept="video/*" multiple
                            onchange="previewVideos(this, 'newsVideoPreview')">
                        <small style="color: #666;">åœ¨æ´»åŠ¨è¯¦æƒ…é¡µå±•ç¤ºï¼Œå¯ä¸Šä¼ å¤šä¸ª</small>
                        <div id="newsVideoPreview" class="video-preview"
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newsParticipantsList">å‚ä¸äººå‘˜ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                        <textarea id="newsParticipantsList" name="participantsList" rows="4"
                            style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"
                            placeholder="å¼ ä¸‰&#10;æå››&#10;ç‹äº”"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="newsStaffList">å·¥ä½œäººå‘˜ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                        <textarea id="newsStaffList" name="staffList" rows="4"
                            style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"
                            placeholder="èµµå…­ï¼ˆè´Ÿè´£äººï¼‰&#10;é’±ä¸ƒï¼ˆæ‘„å½±ï¼‰&#10;å­™å…«ï¼ˆåå‹¤ï¼‰"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('newsModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveNews()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // å·¥å…·å‡½æ•°
        function generateId() {
            return uniqid() + Math.random().toString(36).substr(2, 9);
        }

        function uniqid() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // å…¨å±€å˜é‡
        let currentEditingArticle = null;
        let currentEditingNews = null;
        let articles = [];
        let news = [];

        // æƒé™ç³»ç»Ÿ
        const PERMISSIONS = {
            USER: 'user',
            ADMIN: 'admin',
            SUPER_ADMIN: 'super-admin'
        };

        let currentUser = {
            username: 'admin',
            role: PERMISSIONS.ADMIN,
            avatar: 'A'
        };

        // æ“ä½œæ—¥å¿—
        let operationLogs = [];

        // æ•°æ®åº“APIé›†æˆ
        let useDatabase = false;
        let dbConnected = false;

        // æ£€æŸ¥æ•°æ®åº“è¿æ¥
        async function checkDatabaseConnection() {
            try {
                if (typeof window.dbAPI !== 'undefined') {
                    const connected = await window.dbAPI.checkConnection();
                    dbConnected = connected;
                    console.log('æ•°æ®åº“è¿æ¥çŠ¶æ€:', connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥');
                    return connected;
                }
                return false;
            } catch (error) {
                console.log('æ•°æ®åº“è¿æ¥æ£€æŸ¥å¤±è´¥:', error.message);
                dbConnected = false;
                return false;
            }
        }

        // åˆå§‹åŒ–æ•°æ®åº“è¿æ¥
        async function initDatabase() {
            try {
                const connected = await checkDatabaseConnection();
                if (connected) {
                    useDatabase = true;
                    console.log('âœ… æ•°æ®åº“æ¨¡å¼å·²å¯ç”¨');

                    // ä»æ•°æ®åº“åŠ è½½æ•°æ®
                    await loadDataFromDatabase();
                } else {
                    useDatabase = false;
                    console.log('âš ï¸ ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¨¡å¼');
                }
            } catch (error) {
                console.error('æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥:', error);
                useDatabase = false;
            }
        }

        // ä»æ•°æ®åº“åŠ è½½æ•°æ®
        async function loadDataFromDatabase() {
            try {
                console.log('ä»æ•°æ®åº“åŠ è½½æ•°æ®...');

                // åŠ è½½æ–‡ç« æ•°æ®
                const articlesResult = await window.dbAPI.getArticles();
                if (articlesResult.success) {
                    adminData.articles = articlesResult.data.data || [];
                    console.log('âœ… æ–‡ç« æ•°æ®åŠ è½½æˆåŠŸ:', adminData.articles.length, 'ç¯‡');
                }

                // åŠ è½½æ–°é—»æ•°æ®
                const newsResult = await window.dbAPI.getNews();
                if (newsResult.success) {
                    adminData.news = newsResult.data.data || [];
                    console.log('âœ… æ–°é—»æ•°æ®åŠ è½½æˆåŠŸ:', adminData.news.length, 'æ¡');
                }

                // æ›´æ–°æ˜¾ç¤º
                updateArticlesDisplay();
                updateNewsDisplay();

            } catch (error) {
                console.error('ä»æ•°æ®åº“åŠ è½½æ•°æ®å¤±è´¥:', error);
                throw error;
            }
        }

        // ä¿å­˜æ–‡ç« åˆ°æ•°æ®åº“
        async function saveArticleToDatabase(articleData) {
            try {
                if (useDatabase && dbConnected) {
                    const result = await window.dbAPI.createArticle(articleData);
                    if (result.success) {
                        console.log('âœ… æ–‡ç« ä¿å­˜åˆ°æ•°æ®åº“æˆåŠŸ');
                        return result.data.id;
                    }
                }
                return null;
            } catch (error) {
                console.error('ä¿å­˜æ–‡ç« åˆ°æ•°æ®åº“å¤±è´¥:', error);
                return null;
            }
        }

        // ä¿å­˜æ–°é—»åˆ°æ•°æ®åº“
        async function saveNewsToDatabase(newsData) {
            try {
                if (useDatabase && dbConnected) {
                    const result = await window.dbAPI.createNews(newsData);
                    if (result.success) {
                        console.log('âœ… æ–°é—»ä¿å­˜åˆ°æ•°æ®åº“æˆåŠŸ');
                        return result.data.id;
                    }
                }
                return null;
            } catch (error) {
                console.error('ä¿å­˜æ–°é—»åˆ°æ•°æ®åº“å¤±è´¥:', error);
                return null;
            }
        }

        // åˆ é™¤æ–‡ç« ä»æ•°æ®åº“
        async function deleteArticleFromDatabase(articleId) {
            try {
                if (useDatabase && dbConnected) {
                    const result = await window.dbAPI.deleteArticle(articleId);
                    if (result.success) {
                        console.log('âœ… æ–‡ç« ä»æ•°æ®åº“åˆ é™¤æˆåŠŸ');
                        return true;
                    }
                }
                return false;
            } catch (error) {
                console.error('ä»æ•°æ®åº“åˆ é™¤æ–‡ç« å¤±è´¥:', error);
                return false;
            }
        }

        // åˆ é™¤æ–°é—»ä»æ•°æ®åº“
        async function deleteNewsFromDatabase(newsId) {
            try {
                if (useDatabase && dbConnected) {
                    const result = await window.dbAPI.deleteNews(newsId);
                    if (result.success) {
                        console.log('âœ… æ–°é—»ä»æ•°æ®åº“åˆ é™¤æˆåŠŸ');
                        return true;
                    }
                }
                return false;
            } catch (error) {
                console.error('ä»æ•°æ®åº“åˆ é™¤æ–°é—»å¤±è´¥:', error);
                return false;
            }
        }

        // ä»æ•°æ®åº“åˆ·æ–°ç”¨æˆ·æƒé™ä¿¡æ¯
        async function refreshUserPermissions() {
            try {
                const savedUser = localStorage.getItem('currentUser');
                if (!savedUser) return false;

                const user = JSON.parse(savedUser);

                // å°è¯•ä»æ•°æ®åº“è·å–æœ€æ–°çš„ç”¨æˆ·ä¿¡æ¯
                const response = await fetch('api/auth.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'get_user_info',
                        user_id: user.id,
                        username: user.username
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.data) {
                        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
                        const updatedUser = {
                            id: data.data.id,
                            username: data.data.username,
                            role: data.data.role,
                            avatar: data.data.avatar || user.avatar
                        };

                        // ä¿å­˜åˆ°localStorage
                        localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                        currentUser = updatedUser;

                        console.log('âœ… æƒé™å·²ä»æ•°æ®åº“åˆ·æ–°:', currentUser.role);
                        return true;
                    }
                }

                return false;
            } catch (error) {
                console.log('ä»æ•°æ®åº“åˆ·æ–°æƒé™å¤±è´¥ï¼Œä½¿ç”¨ç¼“å­˜ä¿¡æ¯:', error.message);
                return false;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function () {
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            if (localStorage.getItem('adminLoggedIn') !== 'true') {
                // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
                window.location.href = 'admin-login.html';
                return;
            }

            try {
                // ä»localStorageæ¢å¤ç”¨æˆ·ä¿¡æ¯
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                }

                // ğŸ”¥ æ–°å¢ï¼šå°è¯•ä»æ•°æ®åº“åˆ·æ–°æƒé™
                const refreshed = await refreshUserPermissions();
                if (refreshed) {
                    console.log('âœ… å·²ä»æ•°æ®åº“æ›´æ–°æƒé™');
                } else {
                    console.log('â„¹ï¸ ä½¿ç”¨ç¼“å­˜çš„ç”¨æˆ·ä¿¡æ¯');
                }

                // ç«‹å³æ˜¾ç¤ºç®¡ç†ç•Œé¢
                showAdminSection();
                updateUserInterface();

                // å¹¶è¡Œæ‰§è¡Œæ•°æ®åŠ è½½ä»»åŠ¡
                const tasks = [
                    initDatabase(),
                    loadData(),
                    loadLogs(),
                    setDefaultDate()
                ];

                // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
                await Promise.all(tasks);

            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                showNotification('æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            }
        });

        // æ˜¾ç¤ºç®¡ç†ç•Œé¢
        function showAdminSection() {
            document.getElementById('adminSection').style.display = 'block';
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ\n\nç‚¹å‡»"ç¡®å®š"å°†é€€å‡ºç™»å½•å¹¶è¿”å›é¦–é¡µ')) {
                addLog('logout', 'ç”¨æˆ·é€€å‡º', `ç”¨æˆ· ${currentUser.username} é€€å‡ºç³»ç»Ÿ`);
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminUsername');
                localStorage.removeItem('currentUser');
                showNotification('å·²é€€å‡ºç™»å½•ï¼Œæ­£åœ¨è¿”å›é¦–é¡µ...', 'info');

                // å»¶è¿Ÿè·³è½¬åˆ°é¦–é¡µ
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            }
        }

        // æ‰‹åŠ¨åˆ·æ–°æƒé™
        async function manualRefreshPermissions() {
            showNotification('æ­£åœ¨ä»æ•°æ®åº“åˆ·æ–°æƒé™...', 'info');

            const refreshed = await refreshUserPermissions();

            if (refreshed) {
                // æ›´æ–°ç•Œé¢
                updateUserInterface();

                // æ ¹æ®æ–°æƒé™æ˜¾ç¤ºæˆ–éšè—æ—¥å¿—æ ‡ç­¾
                const logsTabEl = document.getElementById('logsTabBtn');
                if (logsTabEl && currentUser.role === PERMISSIONS.SUPER_ADMIN) {
                    logsTabEl.style.display = 'block';
                    showNotification(`âœ… æƒé™å·²æ›´æ–°ï¼æ‚¨ç°åœ¨æ˜¯${getRoleDisplayName(currentUser.role)}`, 'success');
                } else {
                    showNotification(`âœ… æƒé™å·²åˆ·æ–°ï¼š${getRoleDisplayName(currentUser.role)}`, 'success');
                }

                // æ ¹æ®æ–°æƒé™æ˜¾ç¤ºæˆ–éšè—æ´»åŠ¨å±•ç¤ºæ ‡ç­¾
                const activitiesTabEl = document.getElementById('activitiesTabBtn');
                if (activitiesTabEl && currentUser.role === PERMISSIONS.SUPER_ADMIN) {
                    activitiesTabEl.style.display = 'block';
                }

                console.log('âœ… æ‰‹åŠ¨åˆ·æ–°æƒé™æˆåŠŸ:', currentUser);
            } else {
                showNotification('âŒ æ— æ³•ä»æ•°æ®åº“è·å–æƒé™ä¿¡æ¯', 'error');
            }
        }

        // æ›´æ–°ç”¨æˆ·ç•Œé¢
        function updateUserInterface() {
            const userNameEl = document.getElementById('userName');
            const userRoleEl = document.getElementById('userRole');
            const userAvatarEl = document.getElementById('userAvatar');
            const logsTabEl = document.getElementById('logsTabBtn');

            if (userNameEl) userNameEl.textContent = currentUser.username;
            if (userRoleEl) {
                userRoleEl.textContent = getRoleDisplayName(currentUser.role);
                userRoleEl.className = `user-role ${currentUser.role}`;
            }
            if (userAvatarEl) userAvatarEl.textContent = currentUser.avatar;

            // åªæœ‰è¶…çº§ç®¡ç†å‘˜æ‰èƒ½çœ‹åˆ°æ—¥å¿—æ ‡ç­¾
            if (logsTabEl) {
                logsTabEl.style.display = currentUser.role === PERMISSIONS.SUPER_ADMIN ? 'block' : 'none';
            }

            // åªæœ‰è¶…çº§ç®¡ç†å‘˜æ‰èƒ½çœ‹åˆ°æ´»åŠ¨å±•ç¤ºæ ‡ç­¾
            const activitiesTabEl = document.getElementById('activitiesTabBtn');
            if (activitiesTabEl) {
                activitiesTabEl.style.display = currentUser.role === PERMISSIONS.SUPER_ADMIN ? 'block' : 'none';
            }
        }

        // è·å–è§’è‰²æ˜¾ç¤ºåç§°
        function getRoleDisplayName(role) {
            const roleNames = {
                [PERMISSIONS.USER]: 'æ™®é€šç”¨æˆ·',
                [PERMISSIONS.ADMIN]: 'ç®¡ç†å‘˜',
                [PERMISSIONS.SUPER_ADMIN]: 'è¶…çº§ç®¡ç†å‘˜'
            };
            return roleNames[role] || 'æœªçŸ¥';
        }

        // æƒé™æ£€æŸ¥
        function hasPermission(requiredRole) {
            const roleHierarchy = {
                [PERMISSIONS.USER]: 1,
                [PERMISSIONS.ADMIN]: 2,
                [PERMISSIONS.SUPER_ADMIN]: 3
            };

            return roleHierarchy[currentUser.role] >= roleHierarchy[requiredRole];
        }

        // æ·»åŠ æ“ä½œæ—¥å¿—ï¼ˆä¿å­˜åˆ°æ•°æ®åº“ï¼‰
        async function addLog(action, title, details) {
            const log = {
                action: action,
                title: title,
                details: details,
                user: currentUser.username,
                createdAt: Date.now()
            };

            console.log('æ·»åŠ æ—¥å¿—åˆ°æ•°æ®åº“:', log);

            try {
                // ä¿å­˜åˆ°æ•°æ®åº“
                const response = await fetch('api/operation-logs.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(log)
                });

                const data = await response.json();

                if (data.success) {
                    console.log('âœ… æ—¥å¿—å·²ä¿å­˜åˆ°æ•°æ®åº“');

                    // å¦‚æœå½“å‰åœ¨æ—¥å¿—é¡µé¢ï¼Œæ›´æ–°æ˜¾ç¤º
                    if (document.getElementById('logsTab') && document.getElementById('logsTab').classList.contains('active')) {
                        await loadLogs();
                        renderLogs();
                    }
                } else {
                    console.error('âŒ ä¿å­˜æ—¥å¿—å¤±è´¥:', data.message);
                }
            } catch (error) {
                console.error('âŒ ä¿å­˜æ—¥å¿—åˆ°æ•°æ®åº“å¤±è´¥:', error);
                // é™çº§åˆ°localStorage
                saveLogsLocalStorage(log);
            }
        }

        // é™çº§æ–¹æ¡ˆï¼šä¿å­˜åˆ°localStorage
        function saveLogsLocalStorage(log) {
            try {
                const savedLogs = localStorage.getItem('operationLogs');
                let logs = savedLogs ? JSON.parse(savedLogs) : [];
                logs.unshift(log);
                localStorage.setItem('operationLogs', JSON.stringify(logs));
                console.log('â„¹ï¸ æ—¥å¿—å·²ä¿å­˜åˆ°localStorageï¼ˆé™çº§æ–¹æ¡ˆï¼‰');
            } catch (e) {
                console.error('ä¿å­˜åˆ°localStorageä¹Ÿå¤±è´¥:', e);
            }
        }

        // åŠ è½½æ—¥å¿—ï¼ˆä»æ•°æ®åº“ï¼‰
        async function loadLogs(filter = 'all') {
            try {
                console.log('ä»æ•°æ®åº“åŠ è½½æ—¥å¿—ï¼Œè¿‡æ»¤:', filter);

                const url = filter === 'all'
                    ? 'api/operation-logs.php?action=all'
                    : `api/operation-logs.php?action=${filter}`;

                const response = await fetch(url);
                const data = await response.json();

                if (data.success && data.data && data.data.logs) {
                    operationLogs = data.data.logs;
                    console.log('âœ… æˆåŠŸä»æ•°æ®åº“åŠ è½½æ—¥å¿—ï¼Œæ€»æ•°:', operationLogs.length);
                } else {
                    console.error('âŒ åŠ è½½æ—¥å¿—å¤±è´¥:', data.message);
                    operationLogs = [];
                }
            } catch (error) {
                console.error('âŒ ä»æ•°æ®åº“åŠ è½½æ—¥å¿—å¤±è´¥:', error);
                // é™çº§åˆ°localStorage
                loadLogsFromLocalStorage();
            }
        }

        // é™çº§æ–¹æ¡ˆï¼šä»localStorageåŠ è½½
        function loadLogsFromLocalStorage() {
            try {
                const savedLogs = localStorage.getItem('operationLogs');
                if (savedLogs) {
                    operationLogs = JSON.parse(savedLogs);
                    console.log('â„¹ï¸ ä»localStorageåŠ è½½æ—¥å¿—ï¼ˆé™çº§æ–¹æ¡ˆï¼‰ï¼Œæ€»æ•°:', operationLogs.length);
                } else {
                    operationLogs = [];
                }
            } catch (e) {
                console.error('ä»localStorageåŠ è½½å¤±è´¥:', e);
                operationLogs = [];
            }
        }

        // æ¸²æŸ“æ—¥å¿—
        function renderLogs(filter = 'all') {
            const logListEl = document.getElementById('logList');
            if (!logListEl) {
                console.error('æ‰¾ä¸åˆ°æ—¥å¿—åˆ—è¡¨å…ƒç´  logList');
                return;
            }

            console.log('å¼€å§‹æ¸²æŸ“æ—¥å¿—ï¼Œå½“å‰æ—¥å¿—æ€»æ•°:', operationLogs.length);
            console.log('è¿‡æ»¤æ¡ä»¶:', filter);

            let filteredLogs = operationLogs;
            if (filter !== 'all') {
                filteredLogs = operationLogs.filter(log => log.action === filter);
            }

            console.log('è¿‡æ»¤åæ—¥å¿—æ•°é‡:', filteredLogs.length);

            if (filteredLogs.length === 0) {
                logListEl.innerHTML = `
                    <div class="empty-logs">
                        <i class="fas fa-history"></i>
                        <h3>æš‚æ— æ“ä½œè®°å½•</h3>
                        <p>ç³»ç»Ÿå°†è‡ªåŠ¨è®°å½•æ‰€æœ‰æ“ä½œ</p>
                    </div>
                `;
                return;
            }

            logListEl.innerHTML = filteredLogs.map(log => `
                <div class="log-item">
                    <div class="log-icon ${log.action}">
                        <i class="fas fa-${getActionIcon(log.action)}"></i>
                    </div>
                    <div class="log-content">
                        <div class="log-action">${log.title}</div>
                        <div class="log-details">${log.details}</div>
                        <div class="log-time">${log.timestamp}</div>
                    </div>
                    <div class="log-user">${log.user}</div>
                </div>
            `).join('');

            console.log('æ—¥å¿—æ¸²æŸ“å®Œæˆ');

            // ç¡®ä¿æ—¥å¿—é¡µé¢å’Œåˆ—è¡¨å…ƒç´ å¯è§
            const logsTab = document.getElementById('logsTab');
            const logViewer = document.querySelector('.log-viewer');

            if (logsTab) {
                logsTab.style.cssText = 'display: block !important;';
                logsTab.classList.add('active');
            }

            if (logViewer) {
                logViewer.style.cssText = `
                    display: block !important;
                    width: 100% !important;
                    min-height: 400px !important;
                    height: auto !important;
                    background: white !important;
                    border-radius: 8px !important;
                    padding: 30px !important;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05) !important;
                    margin-top: 20px !important;
                `;
            }

            // å¼ºåˆ¶æ˜¾ç¤ºæ—¥å¿—åˆ—è¡¨
            logListEl.style.cssText = `
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                height: auto !important;
                min-height: 300px !important;
                max-height: 600px !important;
                width: 100% !important;
                overflow-y: auto !important;
                border: 2px solid #e9ecef !important;
                border-radius: 8px !important;
                background: white !important;
                padding: 20px !important;
                box-sizing: border-box !important;
                position: relative !important;
                z-index: 10 !important;
            `;

            // æ£€æŸ¥æ¸²æŸ“åçš„å†…å®¹
            console.log('æ¸²æŸ“åçš„HTMLå†…å®¹:', logListEl.innerHTML.substring(0, 200) + '...');
            console.log('æ—¥å¿—åˆ—è¡¨å…ƒç´ æ ·å¼:', {
                display: logListEl.style.display,
                visibility: logListEl.style.visibility,
                opacity: logListEl.style.opacity,
                height: logListEl.offsetHeight,
                width: logListEl.offsetWidth
            });
        }

        // è·å–æ“ä½œå›¾æ ‡
        function getActionIcon(action) {
            const icons = {
                'create': 'plus',
                'update': 'edit',
                'delete': 'trash',
                'login': 'sign-in-alt',
                'logout': 'sign-out-alt'
            };
            return icons[action] || 'info';
        }

        // è¿‡æ»¤æ—¥å¿—
        function filterLogs(filter) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.log-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            renderLogs(filter);
        }

        // æ¸…ç©ºæ—¥å¿—
        async function clearLogs() {
            if (!hasPermission(PERMISSIONS.SUPER_ADMIN)) {
                showNotification('æƒé™ä¸è¶³ï¼åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯ä»¥æ¸…ç©ºæ—¥å¿—', 'error');
                return;
            }

            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ“ä½œæ—¥å¿—å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                try {
                    // 1. å…ˆæ¸…ç©ºæ•°æ®åº“
                    const response = await fetch('api/operation-logs.php', {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ clear_all: true })
                    });
                    const data = await response.json();

                    if (!data.success) {
                        showNotification('æ¸…ç©ºæ—¥å¿—å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                        return;
                    }

                    // 2. æ¸…ç©ºlocalStorage
                    operationLogs = [];
                    localStorage.removeItem('operationLogs');
                    localStorage.setItem('operationLogs', JSON.stringify([]));

                    // 3. é‡æ–°æ¸²æŸ“
                    renderLogs();

                    // 4. æ·»åŠ æ—¥å¿—è®°å½•
                    addLog('delete', 'æ¸…ç©ºæ—¥å¿—', 'è¶…çº§ç®¡ç†å‘˜æ¸…ç©ºäº†æ‰€æœ‰æ“ä½œæ—¥å¿—');

                    showNotification('æ—¥å¿—å·²æ¸…ç©º', 'success');
                } catch (error) {
                    console.error('æ¸…ç©ºæ—¥å¿—å¤±è´¥:', error);
                    showNotification('æ¸…ç©ºæ—¥å¿—å¤±è´¥: ' + error.message, 'error');
                }
            }
        }

        // åˆ·æ–°æ—¥å¿—
        function refreshLogs() {
            console.log('æ‰‹åŠ¨åˆ·æ–°æ—¥å¿—');
            loadLogs(); // é‡æ–°ä»localStorageåŠ è½½æ—¥å¿—
            renderLogs(); // é‡æ–°æ¸²æŸ“æ—¥å¿—
            showNotification('æ—¥å¿—å·²åˆ·æ–°', 'success');
        }

        // ============================================
        // Excel å¯¼å‡ºåŠŸèƒ½
        // ============================================

        // å¯¼å‡ºæ–°é—»åˆ° Excel
        async function exportNewsToExcel() {
            if (!hasPermission(PERMISSIONS.SUPER_ADMIN)) {
                showNotification('æƒé™ä¸è¶³ï¼åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯ä»¥å¯¼å‡ºæ•°æ®', 'error');
                return;
            }

            try {
                showNotification('æ­£åœ¨å‡†å¤‡å¯¼å‡ºæ•°æ®...', 'info');

                // è·å–æ–°é—»æ•°æ®
                let newsData = news;
                if (newsData.length === 0) {
                    showNotification('æ²¡æœ‰æ–°é—»æ•°æ®å¯ä»¥å¯¼å‡º', 'warning');
                    return;
                }

                // å‡†å¤‡Excelæ•°æ® - åŒ…å«æ‰€æœ‰æ–°å¢å­—æ®µ
                const excelData = newsData.map((item, index) => ({
                    'åºå·': index + 1,
                    'æ ‡é¢˜': item.title || '',
                    'å‰¯æ ‡é¢˜': item.subtitle || '',
                    'å†…å®¹': item.content || '',
                    'æ´»åŠ¨æ—¥æœŸ': item.date || '',
                    'æ´»åŠ¨æ—¶é—´': item.time || '',
                    'æ´»åŠ¨åœ°ç‚¹': item.location || '',
                    'ä¸»åŠæ–¹': item.organizer || '',
                    'è”åˆç»„ç»‡è€…': item.coOrganizer || '',
                    'æ ¸å¿ƒåŠŸèƒ½': item.coreFunction || '',
                    'æ´»åŠ¨äº®ç‚¹': item.highlights || '',
                    'æ´»åŠ¨ç›®æ ‡': item.eventGoal || '',
                    'é¢„æœŸå‚ä¸äººæ•°': item.participants || '',
                    'æ´»åŠ¨è§„æ¨¡': item.eventScale || '',
                    'æ´»åŠ¨è´¹ç”¨': item.eventFee || '',
                    'å‚ä¸äººå‘˜åˆ—è¡¨': (item.participantsList && Array.isArray(item.participantsList))
                        ? item.participantsList.join('\n') : '',
                    'å·¥ä½œäººå‘˜åˆ—è¡¨': (item.staffList && Array.isArray(item.staffList))
                        ? item.staffList.join('\n') : '',
                    'æ–°é—»åˆ†ç±»': item.category || 'æ´»åŠ¨æ–°é—»',
                    'åˆ›å»ºæ—¶é—´': item.createdAt ? new Date(item.createdAt).toLocaleString('zh-CN') : '',
                    'ID': item.id || ''
                }));

                // åˆ›å»ºå·¥ä½œç°¿
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(excelData);

                // è®¾ç½®åˆ—å®½
                ws['!cols'] = [
                    { wch: 6 },   // åºå·
                    { wch: 30 },  // æ ‡é¢˜
                    { wch: 30 },  // å‰¯æ ‡é¢˜
                    { wch: 50 },  // å†…å®¹
                    { wch: 12 },  // æ´»åŠ¨æ—¥æœŸ
                    { wch: 12 },  // æ´»åŠ¨æ—¶é—´
                    { wch: 25 },  // æ´»åŠ¨åœ°ç‚¹
                    { wch: 20 },  // ä¸»åŠæ–¹
                    { wch: 20 },  // è”åˆç»„ç»‡è€…
                    { wch: 30 },  // æ ¸å¿ƒåŠŸèƒ½
                    { wch: 30 },  // æ´»åŠ¨äº®ç‚¹
                    { wch: 30 },  // æ´»åŠ¨ç›®æ ‡
                    { wch: 15 },  // é¢„æœŸå‚ä¸äººæ•°
                    { wch: 15 },  // æ´»åŠ¨è§„æ¨¡
                    { wch: 12 },  // æ´»åŠ¨è´¹ç”¨
                    { wch: 30 },  // å‚ä¸äººå‘˜åˆ—è¡¨
                    { wch: 30 },  // å·¥ä½œäººå‘˜åˆ—è¡¨
                    { wch: 12 },  // æ–°é—»åˆ†ç±»
                    { wch: 20 },  // åˆ›å»ºæ—¶é—´
                    { wch: 10 }   // ID
                ];

                // æ·»åŠ å·¥ä½œè¡¨åˆ°å·¥ä½œç°¿
                XLSX.utils.book_append_sheet(wb, ws, 'æ´»åŠ¨æ–°é—»');

                // ç”Ÿæˆæ–‡ä»¶å
                const timestamp = new Date().toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(/\//g, '-').replace(/:/g, '-').replace(/\s/g, '_');
                const filename = `æ–°é—»æ•°æ®_${timestamp}.xlsx`;

                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, filename);

                // è®°å½•æ—¥å¿—
                await addLog('export', 'å¯¼å‡ºæ–°é—»æ•°æ®', `å¯¼å‡ºäº† ${newsData.length} æ¡æ–°é—»åˆ° Excel æ–‡ä»¶: ${filename}`);

                showNotification(`âœ… æˆåŠŸå¯¼å‡º ${newsData.length} æ¡æ–°é—»ï¼`, 'success');

            } catch (error) {
                console.error('å¯¼å‡ºæ–°é—»å¤±è´¥:', error);
                showNotification('âŒ å¯¼å‡ºå¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¯¼å‡ºæ–‡ç« åˆ° Excel
        async function exportArticlesToExcel() {
            if (!hasPermission(PERMISSIONS.SUPER_ADMIN)) {
                showNotification('æƒé™ä¸è¶³ï¼åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯ä»¥å¯¼å‡ºæ•°æ®', 'error');
                return;
            }

            try {
                showNotification('æ­£åœ¨å‡†å¤‡å¯¼å‡ºæ•°æ®...', 'info');

                // è·å–æ–‡ç« æ•°æ®
                let articlesData = articles;
                if (articlesData.length === 0) {
                    showNotification('æ²¡æœ‰æ–‡ç« æ•°æ®å¯ä»¥å¯¼å‡º', 'warning');
                    return;
                }

                // å‡†å¤‡Excelæ•°æ®
                const excelData = articlesData.map((item, index) => ({
                    'åºå·': index + 1,
                    'æ ‡é¢˜': item.title || '',
                    'å†…å®¹': item.content || '',
                    'é“¾æ¥': item.link || '',
                    'åˆ†ç±»': item.category || '',
                    'å‘å¸ƒæ—¥æœŸ': item.date || '',
                    'ä½œè€…': item.author || 'ä¸œæ–¹ç¾è°·éŸ©å›½ä¸­å¿ƒ',
                    'åˆ›å»ºæ—¶é—´': item.createdAt ? new Date(item.createdAt).toLocaleString('zh-CN') : '',
                    'ID': item.id || ''
                }));

                // åˆ›å»ºå·¥ä½œç°¿
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(excelData);

                // è®¾ç½®åˆ—å®½
                ws['!cols'] = [
                    { wch: 6 },  // åºå·
                    { wch: 30 }, // æ ‡é¢˜
                    { wch: 50 }, // å†…å®¹
                    { wch: 40 }, // é“¾æ¥
                    { wch: 12 }, // åˆ†ç±»
                    { wch: 12 }, // å‘å¸ƒæ—¥æœŸ
                    { wch: 20 }, // ä½œè€…
                    { wch: 20 }, // åˆ›å»ºæ—¶é—´
                    { wch: 10 }  // ID
                ];

                // æ·»åŠ å·¥ä½œè¡¨åˆ°å·¥ä½œç°¿
                XLSX.utils.book_append_sheet(wb, ws, 'å…¬ä¼—å·æ–‡ç« ');

                // ç”Ÿæˆæ–‡ä»¶å
                const timestamp = new Date().toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(/\//g, '-').replace(/:/g, '-').replace(/\s/g, '_');
                const filename = `æ–‡ç« æ•°æ®_${timestamp}.xlsx`;

                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, filename);

                // è®°å½•æ—¥å¿—
                await addLog('export', 'å¯¼å‡ºæ–‡ç« æ•°æ®', `å¯¼å‡ºäº† ${articlesData.length} ç¯‡æ–‡ç« åˆ° Excel æ–‡ä»¶: ${filename}`);

                showNotification(`âœ… æˆåŠŸå¯¼å‡º ${articlesData.length} ç¯‡æ–‡ç« ï¼`, 'success');

            } catch (error) {
                console.error('å¯¼å‡ºæ–‡ç« å¤±è´¥:', error);
                showNotification('âŒ å¯¼å‡ºå¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¯¼å‡ºæ‰€æœ‰æ•°æ®
        async function exportAllData() {
            if (!hasPermission(PERMISSIONS.SUPER_ADMIN)) {
                showNotification('æƒé™ä¸è¶³ï¼åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯ä»¥å¯¼å‡ºæ•°æ®', 'error');
                return;
            }

            try {
                showNotification('æ­£åœ¨å‡†å¤‡å¯¼å‡ºæ‰€æœ‰æ•°æ®...', 'info');

                // åˆ›å»ºå·¥ä½œç°¿
                const wb = XLSX.utils.book_new();

                // 1. å¯¼å‡ºæ–°é—»
                if (news.length > 0) {
                    const newsData = news.map((item, index) => ({
                        'åºå·': index + 1,
                        'æ ‡é¢˜': item.title || '',
                        'å†…å®¹': item.content || '',
                        'æ—¥æœŸ': item.date || '',
                        'æ—¶é—´': item.time || '',
                        'åœ°ç‚¹': item.location || '',
                        'ä¸»åŠæ–¹': item.organizer || '',
                        'è”åˆç»„ç»‡è€…': item.coOrganizer || '',
                        'æ ¸å¿ƒåŠŸèƒ½': item.coreFunction || '',
                        'äº®ç‚¹': item.highlights || '',
                        'åˆ†ç±»': item.category || 'æ´»åŠ¨æ–°é—»',
                        'åˆ›å»ºæ—¶é—´': item.createdAt ? new Date(item.createdAt).toLocaleString('zh-CN') : '',
                        'ID': item.id || ''
                    }));
                    const wsNews = XLSX.utils.json_to_sheet(newsData);
                    wsNews['!cols'] = [
                        { wch: 6 }, { wch: 30 }, { wch: 50 }, { wch: 12 }, { wch: 10 },
                        { wch: 20 }, { wch: 20 }, { wch: 20 }, { wch: 20 }, { wch: 30 },
                        { wch: 12 }, { wch: 20 }, { wch: 10 }
                    ];
                    XLSX.utils.book_append_sheet(wb, wsNews, 'æ´»åŠ¨æ–°é—»');
                }

                // 2. å¯¼å‡ºæ–‡ç« 
                if (articles.length > 0) {
                    const articlesData = articles.map((item, index) => ({
                        'åºå·': index + 1,
                        'æ ‡é¢˜': item.title || '',
                        'å†…å®¹': item.content || '',
                        'é“¾æ¥': item.link || '',
                        'åˆ†ç±»': item.category || '',
                        'å‘å¸ƒæ—¥æœŸ': item.date || '',
                        'ä½œè€…': item.author || 'ä¸œæ–¹ç¾è°·éŸ©å›½ä¸­å¿ƒ',
                        'åˆ›å»ºæ—¶é—´': item.createdAt ? new Date(item.createdAt).toLocaleString('zh-CN') : '',
                        'ID': item.id || ''
                    }));
                    const wsArticles = XLSX.utils.json_to_sheet(articlesData);
                    wsArticles['!cols'] = [
                        { wch: 6 }, { wch: 30 }, { wch: 50 }, { wch: 40 },
                        { wch: 12 }, { wch: 12 }, { wch: 20 }, { wch: 20 }, { wch: 10 }
                    ];
                    XLSX.utils.book_append_sheet(wb, wsArticles, 'å…¬ä¼—å·æ–‡ç« ');
                }

                // 3. å¯¼å‡ºç»Ÿè®¡ä¿¡æ¯
                const statsData = [
                    { 'é¡¹ç›®': 'æ–°é—»æ€»æ•°', 'æ•°é‡': news.length },
                    { 'é¡¹ç›®': 'æ–‡ç« æ€»æ•°', 'æ•°é‡': articles.length },
                    { 'é¡¹ç›®': 'å¯¼å‡ºæ—¶é—´', 'æ•°é‡': new Date().toLocaleString('zh-CN') },
                    { 'é¡¹ç›®': 'å¯¼å‡ºç”¨æˆ·', 'æ•°é‡': currentUser.username }
                ];
                const wsStats = XLSX.utils.json_to_sheet(statsData);
                wsStats['!cols'] = [{ wch: 20 }, { wch: 40 }];
                XLSX.utils.book_append_sheet(wb, wsStats, 'ç»Ÿè®¡ä¿¡æ¯');

                // ç”Ÿæˆæ–‡ä»¶å
                const timestamp = new Date().toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(/\//g, '-').replace(/:/g, '-').replace(/\s/g, '_');
                const filename = `å…¨éƒ¨æ•°æ®_${timestamp}.xlsx`;

                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, filename);

                // è®°å½•æ—¥å¿—
                await addLog('export', 'å¯¼å‡ºæ‰€æœ‰æ•°æ®', `å¯¼å‡ºäº† ${news.length} æ¡æ–°é—»å’Œ ${articles.length} ç¯‡æ–‡ç« åˆ° Excel æ–‡ä»¶: ${filename}`);

                showNotification(`âœ… æˆåŠŸå¯¼å‡ºæ‰€æœ‰æ•°æ®ï¼\næ–°é—»: ${news.length} æ¡\næ–‡ç« : ${articles.length} ç¯‡`, 'success');

            } catch (error) {
                console.error('å¯¼å‡ºæ‰€æœ‰æ•°æ®å¤±è´¥:', error);
                showNotification('âŒ å¯¼å‡ºå¤±è´¥: ' + error.message, 'error');
            }
        }

        // è°ƒè¯•å‡½æ•° - æ£€æŸ¥æ—¥å¿—ç³»ç»ŸçŠ¶æ€
        function debugLogs() {
            console.log('=== æ—¥å¿—ç³»ç»Ÿè°ƒè¯•ä¿¡æ¯ ===');
            console.log('å½“å‰ç”¨æˆ·:', currentUser);
            console.log('å½“å‰æ—¥å¿—æ•°ç»„:', operationLogs);
            console.log('localStorageä¸­çš„æ—¥å¿—:', localStorage.getItem('operationLogs'));
            console.log('æ—¥å¿—æ€»æ•°:', operationLogs.length);

            // æ·»åŠ æµ‹è¯•æ—¥å¿—
            addLog('create', 'æµ‹è¯•æ—¥å¿—', 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ—¥å¿—ï¼Œç”¨äºéªŒè¯ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ');
            console.log('æ·»åŠ æµ‹è¯•æ—¥å¿—åï¼Œæ—¥å¿—æ€»æ•°:', operationLogs.length);
        }

        // å¼ºåˆ¶æ˜¾ç¤ºæ—¥å¿— - è°ƒè¯•ç”¨
        function forceShowLogs() {
            const logListEl = document.getElementById('logList');
            const logViewer = document.querySelector('.log-viewer');
            const logsTab = document.getElementById('logsTab');

            if (!logListEl) {
                console.error('æ‰¾ä¸åˆ°æ—¥å¿—åˆ—è¡¨å…ƒç´ ');
                return;
            }

            // å¼ºåˆ¶è®¾ç½®æ—¥å¿—é¡µé¢æ ·å¼
            if (logsTab) {
                logsTab.style.cssText = `
                    display: block !important;
                    background: white !important;
                    border-radius: 8px !important;
                    padding: 30px !important;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05) !important;
                `;
            }

            // å¼ºåˆ¶è®¾ç½®æ—¥å¿—æŸ¥çœ‹å™¨æ ·å¼
            if (logViewer) {
                logViewer.style.cssText = `
                    display: block !important;
                    width: 100% !important;
                    min-height: 400px !important;
                    height: auto !important;
                    background: white !important;
                    border-radius: 8px !important;
                    padding: 30px !important;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05) !important;
                    margin-top: 20px !important;
                `;
            }

            // æ¸…é™¤æ‰€æœ‰å¯èƒ½çš„éšè—æ ·å¼
            logListEl.style.cssText = `
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                height: auto !important;
                min-height: 300px !important;
                max-height: 600px !important;
                width: 100% !important;
                overflow-y: auto !important;
                border: 2px solid #e9ecef !important;
                border-radius: 8px !important;
                background: white !important;
                padding: 20px !important;
                box-sizing: border-box !important;
                position: relative !important;
                z-index: 10 !important;
            `;

            // ç›´æ¥è®¾ç½®å†…å®¹
            logListEl.innerHTML = operationLogs.map(log => `
                <div style="padding: 15px 20px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 15px;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: white; background: ${log.action === 'create' ? '#28a745' : log.action === 'update' ? '#ffc107' : log.action === 'delete' ? '#dc3545' : '#17a2b8'};">
                        <i class="fas fa-${getActionIcon(log.action)}"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #333; margin-bottom: 4px;">${log.title}</div>
                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 2px;">${log.details}</div>
                        <div style="font-size: 0.8rem; color: #999;">${log.timestamp}</div>
                    </div>
                    <div style="font-size: 0.85rem; color: #667eea; font-weight: 500;">${log.user}</div>
                </div>
            `).join('');

            console.log('å¼ºåˆ¶æ˜¾ç¤ºæ—¥å¿—å®Œæˆï¼Œå†…å®¹é•¿åº¦:', logListEl.innerHTML.length);
            console.log('ä¿®å¤åå…ƒç´ å°ºå¯¸:', {
                logsTab: logsTab ? { height: logsTab.offsetHeight, width: logsTab.offsetWidth } : 'null',
                logViewer: logViewer ? { height: logViewer.offsetHeight, width: logViewer.offsetWidth } : 'null',
                logList: { height: logListEl.offsetHeight, width: logListEl.offsetWidth }
            });
        }

        // ç®€å•æµ‹è¯•å‡½æ•° - ç›´æ¥åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºæ—¥å¿—
        function testLogs() {
            const logListEl = document.getElementById('logList');
            if (!logListEl) {
                console.error('æ‰¾ä¸åˆ°æ—¥å¿—åˆ—è¡¨å…ƒç´ ');
                return;
            }

            // ç›´æ¥è®¾ç½®ç®€å•çš„æµ‹è¯•å†…å®¹
            logListEl.innerHTML = `
                <div style="padding: 20px; background: #f0f0f0; border: 2px solid #333; margin: 10px;">
                    <h3 style="color: #333;">æµ‹è¯•æ—¥å¿—æ˜¾ç¤º</h3>
                    <p style="color: #666;">å¦‚æœä½ èƒ½çœ‹åˆ°è¿™ä¸ªå†…å®¹ï¼Œè¯´æ˜æ—¥å¿—åˆ—è¡¨å…ƒç´ æ˜¯å¯è§çš„</p>
                    <p style="color: #666;">å½“å‰æ—¥å¿—æ•°é‡: ${operationLogs.length}</p>
                </div>
            `;

            // å¼ºåˆ¶è®¾ç½®æ ·å¼
            logListEl.style.cssText = `
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                height: auto !important;
                min-height: 200px !important;
                width: 100% !important;
                background: white !important;
                border: 2px solid red !important;
                padding: 20px !important;
            `;

            console.log('æµ‹è¯•å†…å®¹å·²è®¾ç½®ï¼Œè¯·æ£€æŸ¥é¡µé¢æ˜¯å¦æ˜¾ç¤ºçº¢è‰²è¾¹æ¡†çš„æµ‹è¯•å†…å®¹');
        }

        // å¼ºåˆ¶è®¾ç½®æ—¥å¿—åˆ—è¡¨å°ºå¯¸
        function forceLogListSize() {
            const logListEl = document.getElementById('logList');
            if (!logListEl) {
                console.error('æ—¥å¿—åˆ—è¡¨å…ƒç´ æœªæ‰¾åˆ°');
                return;
            }

            console.log('å¼ºåˆ¶è®¾ç½®æ—¥å¿—åˆ—è¡¨å°ºå¯¸...');

            // ä½¿ç”¨æ›´å¼ºåˆ¶çš„æ–¹å¼è®¾ç½®æ ·å¼
            logListEl.style.setProperty('display', 'block', 'important');
            logListEl.style.setProperty('visibility', 'visible', 'important');
            logListEl.style.setProperty('opacity', '1', 'important');
            logListEl.style.setProperty('height', 'auto', 'important');
            logListEl.style.setProperty('min-height', '300px', 'important');
            logListEl.style.setProperty('max-height', '600px', 'important');
            logListEl.style.setProperty('width', '100%', 'important');
            logListEl.style.setProperty('overflow-y', 'auto', 'important');
            logListEl.style.setProperty('border', '2px solid #e9ecef', 'important');
            logListEl.style.setProperty('border-radius', '8px', 'important');
            logListEl.style.setProperty('background', 'white', 'important');
            logListEl.style.setProperty('padding', '20px', 'important');
            logListEl.style.setProperty('box-sizing', 'border-box', 'important');
            logListEl.style.setProperty('position', 'relative', 'important');
            logListEl.style.setProperty('z-index', '10', 'important');

            // æ£€æŸ¥è®¾ç½®åçš„çŠ¶æ€
            const computedStyle = window.getComputedStyle(logListEl);
            console.log('å¼ºåˆ¶è®¾ç½®åçš„æ ·å¼:', {
                display: computedStyle.display,
                height: computedStyle.height,
                width: computedStyle.width,
                minHeight: computedStyle.minHeight,
                maxHeight: computedStyle.maxHeight
            });

            // å¦‚æœè¿˜æ˜¯æ²¡æœ‰é«˜åº¦ï¼Œå°è¯•è®¾ç½®å›ºå®šé«˜åº¦
            if (computedStyle.height === '0px' || computedStyle.height === 'auto') {
                logListEl.style.setProperty('height', '400px', 'important');
                console.log('è®¾ç½®å›ºå®šé«˜åº¦ 400px');
            }
        }

        // ç®€å•ç›´æ¥çš„æ—¥å¿—æ˜¾ç¤ºæµ‹è¯•
        function showLogsDirectly() {
            console.log('=== ç›´æ¥æ˜¾ç¤ºæ—¥å¿—æµ‹è¯• ===');

            // 1. æ£€æŸ¥å½“å‰ç”¨æˆ·
            console.log('å½“å‰ç”¨æˆ·:', currentUser);
            if (!currentUser || currentUser.role !== 'super-admin') {
                console.error('éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™æ‰èƒ½æŸ¥çœ‹æ—¥å¿—');
                return;
            }

            // 2. æ£€æŸ¥æ—¥å¿—æ•°æ®
            console.log('æ“ä½œæ—¥å¿—æ•°é‡:', operationLogs.length);
            console.log('æ“ä½œæ—¥å¿—å†…å®¹:', operationLogs);

            // 3. ç›´æ¥æ˜¾ç¤ºæ—¥å¿—
            const logListEl = document.getElementById('logList');
            if (!logListEl) {
                console.error('æ‰¾ä¸åˆ°æ—¥å¿—åˆ—è¡¨å…ƒç´ ');
                return;
            }

            // 4. å¼ºåˆ¶æ˜¾ç¤ºæ—¥å¿—é¡µé¢
            const logsTab = document.getElementById('logsTab');
            if (logsTab) {
                logsTab.style.cssText = 'display: block !important;';
                console.log('æ—¥å¿—é¡µé¢å·²æ˜¾ç¤º');
            }

            // 5. å¼ºåˆ¶è®¾ç½®æ—¥å¿—åˆ—è¡¨æ ·å¼
            logListEl.style.cssText = `
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                height: 400px !important;
                width: 100% !important;
                background: white !important;
                border: 2px solid #007bff !important;
                border-radius: 8px !important;
                padding: 20px !important;
                overflow-y: auto !important;
                box-sizing: border-box !important;
            `;

            // 6. ç›´æ¥è®¾ç½®å†…å®¹
            if (operationLogs.length === 0) {
                logListEl.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #666;">
                        <i class="fas fa-info-circle" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3>æš‚æ— æ“ä½œæ—¥å¿—</h3>
                        <p>è¿˜æ²¡æœ‰ä»»ä½•æ“ä½œè®°å½•</p>
                    </div>
                `;
            } else {
                logListEl.innerHTML = operationLogs.map(log => `
                    <div style="padding: 15px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: #007bff; color: white; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-${log.action === 'create' ? 'plus' : log.action === 'update' ? 'edit' : log.action === 'delete' ? 'trash' : 'info'}"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; color: #333;">${log.title}</div>
                            <div style="color: #666; font-size: 0.9rem;">${log.details}</div>
                            <div style="color: #999; font-size: 0.8rem; margin-top: 5px;">
                                ${log.user} â€¢ ${log.timestamp}
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            console.log('æ—¥å¿—å†…å®¹å·²ç›´æ¥è®¾ç½®');
            console.log('æ—¥å¿—åˆ—è¡¨å…ƒç´ çŠ¶æ€:', {
                display: logListEl.style.display,
                height: logListEl.style.height,
                width: logListEl.style.width,
                innerHTML: logListEl.innerHTML.substring(0, 100) + '...'
            });
        }

        // æ·±åº¦è¯Šæ–­å‡½æ•° - æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„é—®é¢˜
        function diagnoseLogs() {
            const logListEl = document.getElementById('logList');
            const logViewer = document.querySelector('.log-viewer');
            const logsTab = document.getElementById('logsTab');

            console.log('=== æ·±åº¦è¯Šæ–­å¼€å§‹ ===');

            // 1. æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
            console.log('1. å…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥:');
            console.log('  - logListEl:', logListEl ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨');
            console.log('  - logViewer:', logViewer ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨');
            console.log('  - logsTab:', logsTab ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨');

            if (!logListEl) {
                console.error('æ—¥å¿—åˆ—è¡¨å…ƒç´ ä¸å­˜åœ¨ï¼');
                return;
            }

            // 2. æ£€æŸ¥å…ƒç´ ä½ç½®å’Œå°ºå¯¸
            console.log('2. å…ƒç´ ä½ç½®å’Œå°ºå¯¸:');
            const rect = logListEl.getBoundingClientRect();
            console.log('  - ä½ç½®:', {
                top: rect.top,
                left: rect.left,
                bottom: rect.bottom,
                right: rect.right,
                width: rect.width,
                height: rect.height
            });
            console.log('  - æ˜¯å¦åœ¨è§†å£å†…:', rect.top >= 0 && rect.left >= 0 && rect.bottom <= window.innerHeight && rect.right <= window.innerWidth);

            // 3. æ£€æŸ¥è®¡ç®—æ ·å¼
            console.log('3. è®¡ç®—æ ·å¼æ£€æŸ¥:');
            const computedStyle = window.getComputedStyle(logListEl);
            console.log('  - display:', computedStyle.display);
            console.log('  - visibility:', computedStyle.visibility);
            console.log('  - opacity:', computedStyle.opacity);
            console.log('  - position:', computedStyle.position);
            console.log('  - z-index:', computedStyle.zIndex);
            console.log('  - overflow:', computedStyle.overflow);

            // 4. æ£€æŸ¥çˆ¶å…ƒç´ 
            console.log('4. çˆ¶å…ƒç´ æ£€æŸ¥:');
            let parent = logListEl.parentElement;
            let level = 0;
            while (parent && level < 5) {
                const parentRect = parent.getBoundingClientRect();
                const parentStyle = window.getComputedStyle(parent);
                console.log(`  - çˆ¶å…ƒç´  ${level}:`, {
                    tagName: parent.tagName,
                    className: parent.className,
                    id: parent.id,
                    display: parentStyle.display,
                    visibility: parentStyle.visibility,
                    opacity: parentStyle.opacity,
                    overflow: parentStyle.overflow,
                    position: parentStyle.position,
                    zIndex: parentStyle.zIndex,
                    size: { width: parentRect.width, height: parentRect.height }
                });
                parent = parent.parentElement;
                level++;
            }

            // 5. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–å…ƒç´ é®æŒ¡
            console.log('5. é®æŒ¡æ£€æŸ¥:');
            const elementsAtPoint = document.elementsFromPoint(rect.left + rect.width / 2, rect.top + rect.height / 2);
            console.log('  - è¯¥ä½ç½®çš„å…ƒç´ :', elementsAtPoint.map(el => ({
                tagName: el.tagName,
                className: el.className,
                id: el.id
            })));

            // 6. å¼ºåˆ¶æ˜¾ç¤ºå¹¶æ£€æŸ¥
            console.log('6. å¼ºåˆ¶æ˜¾ç¤ºæµ‹è¯•:');
            logListEl.style.cssText = `
                position: fixed !important;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
                z-index: 99999 !important;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                width: 400px !important;
                height: 300px !important;
                background: red !important;
                border: 5px solid yellow !important;
                padding: 20px !important;
                color: white !important;
                font-size: 20px !important;
            `;

            logListEl.innerHTML = `
                <div style="text-align: center;">
                    <h1 style="color: white; margin-bottom: 20px;">å¼ºåˆ¶æ˜¾ç¤ºæµ‹è¯•</h1>
                    <p style="color: white; font-size: 16px;">å¦‚æœä½ èƒ½çœ‹åˆ°è¿™ä¸ªçº¢è‰²èƒŒæ™¯ã€é»„è‰²è¾¹æ¡†çš„å†…å®¹ï¼Œè¯´æ˜å…ƒç´ å¯ä»¥æ˜¾ç¤º</p>
                    <p style="color: white; font-size: 16px;">æ—¥å¿—æ•°é‡: ${operationLogs.length}</p>
                </div>
            `;

            console.log('å¼ºåˆ¶æ˜¾ç¤ºè®¾ç½®å®Œæˆï¼Œè¯·æ£€æŸ¥é¡µé¢ä¸­å¤®æ˜¯å¦å‡ºç°çº¢è‰²èƒŒæ™¯çš„æµ‹è¯•å†…å®¹');
        }

        // å¿«é€Ÿä¿®å¤å‡½æ•° - å¼ºåˆ¶æ˜¾ç¤ºæ—¥å¿—é¡µé¢
        function fixLogsDisplay() {
            const logsTab = document.getElementById('logsTab');
            const logViewer = document.querySelector('.log-viewer');
            const logList = document.getElementById('logList');

            if (logsTab) {
                logsTab.style.cssText = 'display: block !important;';
                logsTab.classList.add('active');
            }

            if (logViewer) {
                logViewer.style.cssText = `
                    display: block !important;
                    width: 100% !important;
                    min-height: 400px !important;
                    height: auto !important;
                    background: white !important;
                    border-radius: 8px !important;
                    padding: 30px !important;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05) !important;
                    margin-top: 20px !important;
                `;
            }

            if (logList) {
                logList.style.cssText = `
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    height: auto !important;
                    min-height: 300px !important;
                    max-height: 600px !important;
                    width: 100% !important;
                    overflow-y: auto !important;
                    border: 2px solid #e9ecef !important;
                    border-radius: 8px !important;
                    background: white !important;
                    padding: 20px !important;
                    box-sizing: border-box !important;
                    position: relative !important;
                    z-index: 10 !important;
                `;
            }

            // é‡æ–°æ¸²æŸ“æ—¥å¿—
            renderLogs();
            console.log('æ—¥å¿—æ˜¾ç¤ºå·²ä¿®å¤');
        }

        // å°†è°ƒè¯•å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
        window.debugLogs = debugLogs;
        window.refreshLogs = refreshLogs;
        window.forceShowLogs = forceShowLogs;
        window.testLogs = testLogs;
        window.diagnoseLogs = diagnoseLogs;
        window.fixLogsDisplay = fixLogsDisplay;

        // è·³è½¬åˆ°é¦–é¡µ
        function goToHome() {
            if (confirm('ç¡®å®šè¦è¿”å›é¦–é¡µå—ï¼Ÿ\n\nå½“å‰æœªä¿å­˜çš„æ›´æ”¹å°†ä¼šä¸¢å¤±')) {
                window.location.href = 'index.html';
            }
        }

        // ä»APIåŠ è½½æ•°æ®
        async function loadData() {
            try {
                const response = await fetch('api/get-data.php?type=all');
                const result = await response.json();

                if (result.success && result.data) {
                    articles = result.data.articles || [];
                    news = result.data.news || [];

                    console.log('âœ… æ•°æ®åŠ è½½æˆåŠŸ:', {
                        articles: articles.length,
                        news: news.length
                    });

                    // æ³¨æ„ï¼šä¸ä¿å­˜å®Œæ•´æ•°æ®åˆ°localStorageï¼ˆå›¾ç‰‡æ•°æ®å¤ªå¤§ï¼‰
                    // åªä¿å­˜åŸºæœ¬ä¿¡æ¯ï¼Œé¿å…QuotaExceededError
                    try {
                        // åªä¿å­˜ä¸å¸¦å›¾ç‰‡çš„æ•°æ®å‰¯æœ¬
                        const articlesWithoutImages = articles.map(a => ({
                            id: a.id,
                            title: a.title,
                            category: a.category,
                            date: a.date,
                            author: a.author
                        }));
                        localStorage.setItem('articles_meta', JSON.stringify(articlesWithoutImages));

                        const newsWithoutImages = news.map(n => ({
                            id: n.id,
                            title: n.title,
                            category: n.category,
                            date: n.date
                        }));
                        localStorage.setItem('news_meta', JSON.stringify(newsWithoutImages));

                        localStorage.setItem('lastLoadTime', Date.now().toString());
                        console.log('âœ… å·²ä¿å­˜å…ƒæ•°æ®åˆ°localStorage');
                    } catch (e) {
                        console.warn('âš ï¸ æ— æ³•ä¿å­˜å…ƒæ•°æ®ï¼ˆä¸å½±å“æ˜¾ç¤ºï¼‰:', e.message);
                    }
                } else {
                    console.error('APIåŠ è½½å¤±è´¥:', result.message);
                    // å°è¯•ä»localStorageåŠ è½½å…ƒæ•°æ®ï¼ˆé€šå¸¸ä¸ºç©ºï¼‰
                    articles = JSON.parse(localStorage.getItem('articles') || '[]');
                    news = JSON.parse(localStorage.getItem('news') || '[]');
                }
            } catch (error) {
                console.error('âŒ åŠ è½½æ•°æ®å¤±è´¥:', error);

                // å¦‚æœæ˜¯å­˜å‚¨ç©ºé—´é—®é¢˜ï¼Œç›´æ¥ä½¿ç”¨å†…å­˜ä¸­çš„æ•°æ®
                if (error.name === 'QuotaExceededError') {
                    console.warn('âš ï¸ localStorageç©ºé—´ä¸è¶³ï¼Œä½¿ç”¨APIæ•°æ®ç›´æ¥æ˜¾ç¤º');
                    // æ•°æ®å·²ç»åœ¨ä¸Šé¢åŠ è½½åˆ°å†…å­˜ä¸­äº†ï¼Œç›´æ¥ä½¿ç”¨
                } else {
                    // å…¶ä»–é”™è¯¯ï¼Œå°è¯•ä»localStorageåŠ è½½
                    articles = JSON.parse(localStorage.getItem('articles') || '[]');
                    news = JSON.parse(localStorage.getItem('news') || '[]');
                }
            }

            // æ›´æ–°æ˜¾ç¤º
            updateArticlesDisplay();
            updateNewsDisplay();
            updateStats();
        }

        // ä¿å­˜æ•°æ®åˆ°localStorageï¼ˆä¸ä¿å­˜å®Œæ•´æ•°æ®ï¼Œåªä¿å­˜æ›´æ–°ä¿¡å·ï¼‰
        function saveData() {
            try {
                // ä¸ä¿å­˜å®Œæ•´æ•°æ®ï¼ˆå› ä¸ºå›¾ç‰‡æ•°æ®å¤ªå¤§ï¼‰ï¼Œåªä¿å­˜æ—¶é—´æˆ³
                const updateInfo = {
                    lastUpdated: new Date().toISOString(),
                    articlesCount: articles.length,
                    newsCount: news.length
                };
                localStorage.setItem('updateInfo', JSON.stringify(updateInfo));

                // è§¦å‘storageäº‹ä»¶ï¼Œé€šçŸ¥å…¶ä»–é¡µé¢éœ€è¦åˆ·æ–°æ•°æ®
                window.dispatchEvent(new StorageEvent('storage', {
                    key: 'updateInfo',
                    newValue: JSON.stringify(updateInfo)
                }));

                // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œé€šçŸ¥åŒä¸€æ ‡ç­¾é¡µå†…çš„å…¶ä»–é¡µé¢æ›´æ–°
                window.dispatchEvent(new CustomEvent('storageUpdate', {
                    detail: {
                        key: 'updateInfo',
                        newValue: JSON.stringify(updateInfo)
                    }
                }));

                console.log('âœ… æ•°æ®æ›´æ–°æ—¶é—´å·²è®°å½•:', updateInfo);
            } catch (e) {
                console.warn('âš ï¸ æ— æ³•ä¿å­˜æ›´æ–°ä¿¡æ¯ï¼ˆä¸å½±å“æ“ä½œï¼‰:', e.message);
                // å³ä½¿ä¿å­˜å¤±è´¥ï¼Œä¹Ÿè§¦å‘äº‹ä»¶é€šçŸ¥å…¶ä»–é¡µé¢åˆ·æ–°
                window.dispatchEvent(new CustomEvent('storageUpdate', {
                    detail: {
                        key: 'forceRefresh',
                        newValue: Date.now().toString()
                    }
                }));
            }
        }

        // æ›´æ–°æ–‡ç« æ˜¾ç¤º
        function updateArticlesDisplay() {
            const articlesList = document.getElementById('articlesList');

            if (articles.length === 0) {
                articlesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <h3>æš‚æ— æ–‡ç« </h3>
                        <p>ç‚¹å‡»"æ·»åŠ æ–‡ç« "å¼€å§‹åˆ›å»ºå†…å®¹</p>
                    </div>
                `;
                return;
            }

            // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            const sortedArticles = articles.sort((a, b) => new Date(b.date) - new Date(a.date));

            articlesList.innerHTML = sortedArticles.map((article, index) => `
                <div class="article-link-item admin-article-item">
                    <div class="article-link-content">
                        <div class="article-link-meta">
                            <span class="article-link-category">${article.category}</span>
                            <span class="article-link-date">${article.date}</span>
                        </div>
                        <h3 class="article-link-title">${article.title}</h3>
                        <p class="article-link-desc">${article.content}</p>
                        <div class="article-link-actions">
                            <button class="action-btn edit-btn" onclick="editArticle(${index})">
                                <i class="fas fa-edit"></i> ç¼–è¾‘
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteArticle(${index})">
                                <i class="fas fa-trash"></i> åˆ é™¤
                            </button>
                            <a href="${article.link}" target="_blank" class="action-btn view-btn">
                                <i class="fas fa-external-link-alt"></i> æŸ¥çœ‹
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // æ›´æ–°æ–°é—»æ˜¾ç¤º
        function updateNewsDisplay() {
            const newsList = document.getElementById('newsList');

            if (news.length === 0) {
                newsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-newspaper"></i>
                        <h3>æš‚æ— æ–°é—»</h3>
                        <p>ç‚¹å‡»"æ·»åŠ æ–°é—»"å¼€å§‹åˆ›å»ºå†…å®¹</p>
                    </div>
                `;
                return;
            }

            // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            const sortedNews = news.sort((a, b) => new Date(b.date) - new Date(a.date));

            newsList.innerHTML = sortedNews.map((newsItem, index) => {
                // ä¼˜å…ˆä½¿ç”¨å°é¢å›¾
                let coverImage = '';
                if (newsItem.coverImage) {
                    coverImage = newsItem.coverImage;
                    console.log(`[æ–°é—»${index}] ä½¿ç”¨ coverImage å­—æ®µï¼Œé•¿åº¦: ${coverImage.length}`);
                } else if (newsItem.cover_image) {
                    coverImage = newsItem.cover_image;
                    console.log(`[æ–°é—»${index}] ä½¿ç”¨ cover_image å­—æ®µï¼Œé•¿åº¦: ${coverImage.length}`);
                } else {
                    console.log(`[æ–°é—»${index}] æ— å°é¢å›¾`);
                }

                // ç”Ÿæˆå°é¢å›¾å®¹å™¨ï¼ˆå ä½ï¼Œç¨åé€šè¿‡JSå¡«å……ï¼‰
                const coverImageHtml = coverImage ? `
                    <div class="news-cover-preview" data-cover="${index}" style="width: 100px; height: 100px; overflow: hidden; border-radius: 8px; margin-right: 15px; flex-shrink: 0; background: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                        <div style="color: #999; font-size: 0.8rem;">åŠ è½½ä¸­...</div>
                    </div>
                ` : '';

                return `
                <div class="article-link-item admin-article-item">
                    <div class="article-link-content" style="display: flex; align-items: flex-start;">
                        ${coverImageHtml}
                        <div style="flex: 1;">
                            <div class="article-link-meta">
                                <span class="article-link-category">${newsItem.category || 'æ–°é—»'}</span>
                                <span class="article-link-date">${newsItem.date} ${newsItem.time ? newsItem.time : ''}</span>
                            </div>
                            <h3 class="article-link-title">${newsItem.title}</h3>
                            <p class="article-link-desc">${newsItem.content}</p>
                        <div class="news-details">
                            <div class="news-detail-item">
                                <strong>ä¸»åŠæ–¹ï¼š</strong>${newsItem.organizer || ''}
                            </div>
                            <div class="news-detail-item">
                                <strong>åœ°ç‚¹ï¼š</strong>${newsItem.location || ''}
                            </div>
                            ${newsItem.coOrganizer ? `
                            <div class="news-detail-item">
                                <strong>è”åˆç»„ç»‡è€…ï¼š</strong>${newsItem.coOrganizer}
                            </div>
                            ` : ''}
                            <div class="news-detail-item">
                                <strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong>${newsItem.coreFunction || ''}
                            </div>
                            <div class="news-detail-item">
                                <strong>äº®ç‚¹æ´»åŠ¨ï¼š</strong>${newsItem.highlights || ''}
                            </div>
                            </div>
                            <div class="article-link-actions">
                                <button class="action-btn edit-btn" onclick="editNews(${index})">
                                    <i class="fas fa-edit"></i> ç¼–è¾‘
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteNews(${index})">
                                    <i class="fas fa-trash"></i> åˆ é™¤
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            }).join('');

            // åŠ¨æ€å¡«å……å°é¢å›¾ - ä½¿ç”¨Blob URLé¿å…base64å­—ç¬¦ä¸²è¿‡é•¿é—®é¢˜
            requestAnimationFrame(() => {
                sortedNews.forEach((newsItem, idx) => {
                    const preview = document.querySelector(`.news-cover-preview[data-cover="${idx}"]`);
                    if (preview) {
                        const coverImage = newsItem.coverImage || newsItem.cover_image || '';
                        if (coverImage && coverImage.trim() !== '') {
                            try {
                                // æ–¹æ³•1: å°è¯•ç›´æ¥ä½¿ç”¨
                                const img = document.createElement('img');
                                img.alt = 'å°é¢';
                                img.style.cssText = 'width: 100%; height: 100%; object-fit: cover;';

                                // è®¾ç½®åŠ è½½å›è°ƒ
                                let loaded = false;
                                img.onload = function () {
                                    loaded = true;
                                    console.log(`[æ–°é—»${idx}] å°é¢å›¾åŠ è½½æˆåŠŸ`);
                                };

                                img.onerror = function () {
                                    if (!loaded) {
                                        console.warn(`[æ–°é—»${idx}] ç›´æ¥åŠ è½½å¤±è´¥ï¼Œå°è¯•ç®€åŒ–æ˜¾ç¤º`);
                                        this.parentElement.innerHTML = '<div style="color: #999; font-size: 0.8rem;">å°é¢</div>';
                                        this.parentElement.style.display = 'flex';
                                        this.parentElement.style.alignItems = 'center';
                                        this.parentElement.style.justifyContent = 'center';
                                    }
                                };

                                // éªŒè¯base64æ ¼å¼
                                let finalSrc = coverImage;
                                if (!coverImage.startsWith('data:')) {
                                    finalSrc = 'data:image/png;base64,' + coverImage;
                                }

                                img.src = finalSrc;
                                preview.innerHTML = '';
                                preview.appendChild(img);
                            } catch (e) {
                                console.error(`[æ–°é—»${idx}] å°é¢å›¾å¤„ç†å¼‚å¸¸:`, e);
                                preview.innerHTML = '';
                                preview.style.display = 'none';
                            }
                        } else {
                            preview.style.display = 'none';
                        }
                    }
                });
            });
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('articleCount').textContent = articles.length;
            document.getElementById('newsCount').textContent = news.length;
        }

        // æ‰“å¼€æ–‡ç« æ¨¡æ€æ¡†
        function openArticleModal(articleIndex = null) {
            currentEditingArticle = articleIndex;
            const modal = document.getElementById('articleModal');
            const title = document.getElementById('articleModalTitle');

            if (articleIndex !== null) {
                title.textContent = 'ç¼–è¾‘æ–‡ç« ';
                const article = articles[articleIndex];
                document.getElementById('articleTitle').value = article.title;
                document.getElementById('articleContent').value = article.content;
                document.getElementById('articleLink').value = article.link;
                document.getElementById('articleCategory').value = article.category;
                document.getElementById('articleDate').value = article.date;
            } else {
                title.textContent = 'æ·»åŠ æ–‡ç« ';
                document.getElementById('articleForm').reset();
                setDefaultDate();
            }

            modal.classList.add('active');
        }

        // æ‰“å¼€æ–°é—»æ¨¡æ€æ¡†
        function openNewsModal(newsIndex = null) {
            currentEditingNews = newsIndex;
            const modal = document.getElementById('newsModal');
            const title = document.getElementById('newsModalTitle');

            if (newsIndex !== null) {
                title.textContent = 'ç¼–è¾‘æ–°é—»';
                const newsItem = news[newsIndex];

                // å¡«å……æ‰€æœ‰å­—æ®µ
                document.getElementById('newsTitle').value = newsItem.title || '';
                document.getElementById('newsSubtitle').value = newsItem.subtitle || '';
                document.getElementById('newsContent').value = newsItem.content || '';
                document.getElementById('newsDate').value = newsItem.date || '';
                document.getElementById('newsTime').value = newsItem.time || '';
                document.getElementById('newsLocation').value = newsItem.location || '';
                document.getElementById('newsOrganizer').value = newsItem.organizer || '';
                document.getElementById('newsCoOrganizer').value = newsItem.coOrganizer || '';
                document.getElementById('newsCoreFunction').value = newsItem.coreFunction || '';
                document.getElementById('newsHighlights').value = newsItem.highlights || '';
                document.getElementById('newsEventGoal').value = newsItem.eventGoal || '';
                document.getElementById('newsParticipants').value = newsItem.participants || '';
                document.getElementById('newsEventScale').value = newsItem.eventScale || '';
                document.getElementById('newsEventFee').value = newsItem.eventFee || '';
                document.getElementById('newsCategory').value = newsItem.category || 'æ´»åŠ¨æ–°é—»';

                // å¡«å……å‚ä¸äººå‘˜å’Œå·¥ä½œäººå‘˜ï¼ˆå¦‚æœæ˜¯æ•°ç»„ï¼Œè½¬æ¢ä¸ºæ¢è¡Œåˆ†éš”çš„æ–‡æœ¬ï¼‰
                const participantsText = Array.isArray(newsItem.participantsList)
                    ? newsItem.participantsList.join('\n')
                    : (newsItem.participants || '');
                document.getElementById('newsParticipantsList').value = participantsText;

                const staffText = Array.isArray(newsItem.staffList)
                    ? newsItem.staffList.join('\n')
                    : (newsItem.staff || '');
                document.getElementById('newsStaffList').value = staffText;

                // æ¸…ç©ºå›¾ç‰‡å’Œè§†é¢‘é¢„è§ˆï¼ˆå› ä¸ºéœ€è¦é‡æ–°ä¸Šä¼ ï¼‰
                document.getElementById('newsCoverImagePreview').innerHTML = '';
                document.getElementById('newsImagePreview').innerHTML = '';
                document.getElementById('newsVideoPreview').innerHTML = '';
                document.getElementById('newsCoverImage').value = '';
                document.getElementById('newsImage').value = '';
                document.getElementById('newsVideo').value = '';

            } else {
                title.textContent = 'æ·»åŠ æ–°é—»';
                document.getElementById('newsForm').reset();
                setDefaultDate();
            }

            modal.classList.add('active');
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            currentEditingArticle = null;
            currentEditingNews = null;
        }

        // ä¿å­˜æ–‡ç« 
        async function saveArticle() {
            const form = document.getElementById('articleForm');
            const formData = new FormData(form);
            const articleData = Object.fromEntries(formData);

            // éªŒè¯è¡¨å•
            if (!articleData.title || !articleData.content || !articleData.link || !articleData.category || !articleData.date) {
                showNotification('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼', 'error');
                return;
            }

            // éªŒè¯URLæ ¼å¼
            try {
                new URL(articleData.link);
            } catch {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„é“¾æ¥åœ°å€ï¼', 'error');
                return;
            }

            try {
                let response, result;

                if (currentEditingArticle !== null) {
                    // ç¼–è¾‘æ¨¡å¼ - è°ƒç”¨APIæ›´æ–°
                    const article = articles[currentEditingArticle];
                    const updateData = {
                        title: articleData.title,
                        content: articleData.content,
                        link: articleData.link,
                        category: articleData.category,
                        publish_date: articleData.date,
                        author: articleData.author || 'ä¸œæ–¹ç¾è°·éŸ©å›½ä¸­å¿ƒ'
                    };

                    response = await fetch(`api/manage-data.php?type=articles&id=${article.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updateData)
                    });
                    result = await response.json();

                    if (result.success) {
                        // æ›´æ–°æœ¬åœ°æ•°æ®
                        articles[currentEditingArticle] = { ...article, ...articleData };
                        addLog('update', 'ç¼–è¾‘æ–‡ç« ', `ç¼–è¾‘æ–‡ç« : "${articleData.title}" (åˆ†ç±»: ${articleData.category})`);
                        showNotification('æ–‡ç« æ›´æ–°æˆåŠŸï¼', 'success');
                    } else {
                        throw new Error(result.message || 'æ›´æ–°å¤±è´¥');
                    }
                } else {
                    // æ·»åŠ æ¨¡å¼ - è°ƒç”¨APIåˆ›å»º
                    const newData = {
                        title: articleData.title,
                        content: articleData.content,
                        link: articleData.link,
                        category: articleData.category,
                        publish_date: articleData.date,
                        author: articleData.author || 'ä¸œæ–¹ç¾è°·éŸ©å›½ä¸­å¿ƒ'
                    };

                    response = await fetch('api/manage-data.php?type=articles', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newData)
                    });
                    result = await response.json();

                    if (result.success) {
                        const newArticle = {
                            id: result.data.id,
                            ...articleData,
                            createdAt: Date.now()
                        };
                        articles.push(newArticle);
                        addLog('create', 'æ·»åŠ æ–‡ç« ', `æ·»åŠ æ–‡ç« : "${articleData.title}" (åˆ†ç±»: ${articleData.category})`);
                        showNotification('æ–‡ç« æ·»åŠ æˆåŠŸï¼', 'success');
                    } else {
                        throw new Error(result.message || 'æ·»åŠ å¤±è´¥');
                    }
                }

                // é‡æ–°åŠ è½½æ•°æ®
                await loadData();
                updateArticlesDisplay();
                updateStats();
                closeModal('articleModal');

            } catch (error) {
                console.error('ä¿å­˜æ–‡ç« å¤±è´¥:', error);
                showNotification('ä¿å­˜æ–‡ç« å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¤šå›¾ç‰‡é¢„è§ˆå‡½æ•°
        function previewImages(input, previewId) {
            const preview = document.getElementById(previewId);
            const files = Array.from(input.files);

            if (files.length > 0) {
                preview.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„é¢„è§ˆ
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const imgDiv = document.createElement('div');
                        imgDiv.style.cssText = 'position: relative; aspect-ratio: 1; overflow: hidden; border-radius: 8px;';
                        imgDiv.innerHTML = `<img src="${e.target.result}" alt="é¢„è§ˆ" style="width: 100%; height: 100%; object-fit: cover;">`;
                        preview.appendChild(imgDiv);
                    };
                    reader.readAsDataURL(file);
                });
                preview.classList.add('show');
            } else {
                preview.classList.remove('show');
                preview.innerHTML = '';
            }
        }

        // å¤šè§†é¢‘é¢„è§ˆå‡½æ•°
        function previewVideos(input, previewId) {
            const preview = document.getElementById(previewId);
            const files = Array.from(input.files);

            if (files.length > 0) {
                preview.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„é¢„è§ˆ
                files.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const videoDiv = document.createElement('div');
                        videoDiv.style.cssText = 'position: relative; background: #000; border-radius: 8px; overflow: hidden;';
                        videoDiv.innerHTML = `<video controls style="width: 100%;" src="${e.target.result}"></video>`;
                        preview.appendChild(videoDiv);
                    };
                    reader.readAsDataURL(file);
                });
                preview.classList.add('show');
            } else {
                preview.classList.remove('show');
                preview.innerHTML = '';
            }
        }

        // å°é¢å›¾ç‰‡é¢„è§ˆå‡½æ•°
        function previewCover(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];

            if (file) {
                // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆå¢åŠ åˆ°2MBé™åˆ¶ï¼‰
                const fileSizeMB = file.size / 1024 / 1024;

                if (fileSizeMB > 2) {
                    alert('âŒ é”™è¯¯ï¼šå›¾ç‰‡å¤§å°è¶…è¿‡2MBï¼Œè¯·å‹ç¼©åä¸Šä¼ ï¼\n\nå½“å‰å¤§å°ï¼š' + fileSizeMB.toFixed(2) + 'MB');
                    input.value = ''; // æ¸…ç©ºé€‰æ‹©
                    preview.classList.remove('show');
                    preview.innerHTML = '';
                    return;
                } else if (fileSizeMB > 1) {
                    alert('âš ï¸ æç¤ºï¼šå›¾ç‰‡è¾ƒå¤§ï¼ˆè¶…è¿‡1MBï¼‰ï¼Œä¸Šä¼ å¯èƒ½éœ€è¦å‡ ç§’é’Ÿã€‚');
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="å°é¢é¢„è§ˆ" style="max-width: 100%; height: auto; border-radius: 8px;">
                        <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">æ–‡ä»¶å¤§å°: ${(fileSizeMB).toFixed(2)}MB</p>`;
                    preview.classList.add('show');
                };
                reader.readAsDataURL(file);
            } else {
                preview.classList.remove('show');
                preview.innerHTML = '';
            }
        }

        // ä¿å­˜æ–°é—» - æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ 
        function saveNews() {
            const form = document.getElementById('newsForm');
            const formData = new FormData(form);

            // å¤„ç†å¤šæ–‡ä»¶ä¸Šä¼ 
            const coverFile = document.getElementById('newsCoverImage').files[0];
            const imageFiles = Array.from(document.getElementById('newsImage').files);
            const videoFiles = Array.from(document.getElementById('newsVideo').files);

            // å¤„ç†å‚ä¸äººå‘˜å’Œå·¥ä½œäººå‘˜
            const participantsList = formData.get('participantsList');
            const staffList = formData.get('staffList');

            const participantsArray = participantsList ? participantsList.split('\n').filter(item => item.trim()) : [];
            const staffArray = staffList ? staffList.split('\n').filter(item => item.trim()) : [];

            // åˆ›å»ºæ–°é—»æ•°æ®å¯¹è±¡
            const newsData = {
                id: Date.now().toString(36) + Math.random().toString(36).slice(2, 8),
                createdAt: Date.now(),
                title: formData.get('title'),
                subtitle: formData.get('subtitle') || '', // æ·»åŠ å‰¯æ ‡é¢˜
                content: formData.get('content'),
                date: formData.get('date'),
                time: formData.get('time') || '',
                location: formData.get('location'),
                organizer: formData.get('organizer'),
                coOrganizer: formData.get('coOrganizer') || '',
                coreFunction: formData.get('coreFunction'),
                highlights: formData.get('highlights'),
                eventGoal: formData.get('eventGoal') || '',
                participants: formData.get('participants') || '',
                eventScale: formData.get('eventScale') || '',
                eventFee: formData.get('eventFee') || '',
                category: formData.get('category') || 'æ´»åŠ¨æ–°é—»',
                coverImage: null, // å°é¢å›¾ç‰‡
                images: [], // æ”¹ä¸ºæ•°ç»„
                videos: [],  // æ”¹ä¸ºæ•°ç»„
                participantsList: participantsArray,
                staffList: staffArray
            };

            // è®¡æ•°å™¨ï¼Œç¡®ä¿æ‰€æœ‰æ–‡ä»¶å¤„ç†å®Œæˆ
            let processedCount = 0;
            const totalFiles = (coverFile ? 1 : 0) + imageFiles.length + videoFiles.length;
            const totalOperations = Math.max(totalFiles, 1); // è‡³å°‘æ‰§è¡Œ1æ¬¡

            function checkAndProcess() {
                processedCount++;
                console.log(`â³ å¤„ç†è¿›åº¦: ${processedCount}/${totalOperations}, æ€»æ–‡ä»¶æ•°: ${totalFiles}`);
                if (processedCount >= totalOperations) {
                    // è½¬æ¢ä¸ºé€‚åˆAPIçš„æ ¼å¼
                    console.log(`ğŸ“Š æ–‡ä»¶å¤„ç†å®Œæˆ:`);
                    console.log(`  - å›¾ç‰‡æ•°é‡: ${newsData.images.length}`);
                    console.log(`  - è§†é¢‘æ•°é‡: ${newsData.videos.length}`);
                    newsData.image = newsData.images.length > 0 ? newsData.images : '';
                    newsData.video = newsData.videos.length > 0 ? newsData.videos : '';
                    processNewsData(newsData);
                }
            }

            // å¦‚æœæ²¡æœ‰ä»»ä½•æ–‡ä»¶ï¼Œç›´æ¥å¤„ç†
            if (totalFiles === 0) {
                checkAndProcess();
            } else {
                // å¤„ç†å°é¢å›¾ç‰‡
                if (coverFile) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        newsData.coverImage = e.target.result;
                        console.log('å°é¢å›¾ç‰‡å·²åŠ è½½');
                        checkAndProcess();
                    };
                    reader.onerror = function (e) {
                        console.error('å°é¢å›¾ç‰‡åŠ è½½å¤±è´¥:', e);
                        checkAndProcess();
                    };
                    reader.readAsDataURL(coverFile);
                }

                // å¤„ç†æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶
                if (imageFiles.length > 0) {
                    console.log(`ğŸ“· å¼€å§‹å¤„ç† ${imageFiles.length} å¼ å›¾ç‰‡`);
                    imageFiles.forEach((file, index) => {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            newsData.images.push(e.target.result);
                            console.log(`âœ… å›¾ç‰‡ ${index + 1}/${imageFiles.length} å·²åŠ è½½ï¼Œå¤§å°: ${(e.target.result.length / 1024).toFixed(2)}KB`);
                            checkAndProcess();
                        };
                        reader.onerror = function (e) {
                            console.error(`âŒ å›¾ç‰‡ ${index + 1} åŠ è½½å¤±è´¥:`, e);
                            checkAndProcess();
                        };
                        reader.readAsDataURL(file);
                    });
                } else {
                    console.log('â„¹ï¸ æ²¡æœ‰ä¸Šä¼ å›¾ç‰‡');
                }

                // å¤„ç†æ‰€æœ‰è§†é¢‘æ–‡ä»¶
                if (videoFiles.length > 0) {
                    videoFiles.forEach((file, index) => {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            newsData.videos.push(e.target.result);
                            console.log(`è§†é¢‘ ${index + 1} å·²åŠ è½½`);
                            checkAndProcess();
                        };
                        reader.onerror = function (e) {
                            console.error(`è§†é¢‘ ${index + 1} åŠ è½½å¤±è´¥:`, e);
                            checkAndProcess();
                        };
                        reader.readAsDataURL(file);
                    });
                }
            }
        }

        // å¤„ç†æ–°é—»æ•°æ®
        async function processNewsData(newsData) {
            // éªŒè¯è¡¨å•
            if (!newsData.title || !newsData.content || !newsData.date || !newsData.location || !newsData.organizer || !newsData.coreFunction) {
                showNotification('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼', 'error');
                return;
            }

            try {
                let response, result;

                if (currentEditingNews !== null) {
                    // ç¼–è¾‘æ¨¡å¼ - è°ƒç”¨APIæ›´æ–°
                    const oldNews = news[currentEditingNews];
                    const updateData = {
                        title: newsData.title,
                        subtitle: newsData.subtitle || '', // æ·»åŠ å‰¯æ ‡é¢˜
                        content: newsData.content,
                        event_date: newsData.date,
                        event_time: newsData.time || '',
                        location: newsData.location,
                        organizer: newsData.organizer,
                        co_organizer: newsData.coOrganizer || '',
                        core_function: newsData.coreFunction,
                        highlights: newsData.highlights || '',
                        event_goal: newsData.eventGoal || '',
                        participants: newsData.participants || '',
                        event_scale: newsData.eventScale || '',
                        event_fee: newsData.eventFee || '',
                        category: newsData.category || 'æ´»åŠ¨æ–°é—»',
                        cover_image: newsData.coverImage || '',
                        image: newsData.image || '',
                        video: newsData.video || '',
                        participants_list: newsData.participantsList || [],
                        staff_list: newsData.staffList || []
                    };

                    response = await fetch(`api/manage-data.php?type=news&id=${oldNews.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updateData)
                    });
                    result = await response.json();

                    if (result.success) {
                        news[currentEditingNews] = newsData;
                        addLog('update', 'ç¼–è¾‘æ–°é—»', `ç¼–è¾‘æ–°é—»: "${newsData.title}" (æ—¶é—´: ${newsData.date} ${newsData.time})`);
                        showNotification('æ–°é—»æ›´æ–°æˆåŠŸï¼', 'success');
                    } else {
                        throw new Error(result.message || 'æ›´æ–°å¤±è´¥');
                    }
                } else {
                    // æ·»åŠ æ¨¡å¼ - è°ƒç”¨APIåˆ›å»º
                    const newData = {
                        title: newsData.title,
                        subtitle: newsData.subtitle || '', // æ·»åŠ å‰¯æ ‡é¢˜
                        content: newsData.content,
                        event_date: newsData.date,
                        event_time: newsData.time || '',
                        location: newsData.location,
                        organizer: newsData.organizer,
                        co_organizer: newsData.coOrganizer || '',
                        core_function: newsData.coreFunction,
                        highlights: newsData.highlights || '',
                        event_goal: newsData.eventGoal || '',
                        participants: newsData.participants || '',
                        event_scale: newsData.eventScale || '',
                        event_fee: newsData.eventFee || '',
                        category: newsData.category || 'æ´»åŠ¨æ–°é—»',
                        cover_image: newsData.coverImage || '',
                        image: newsData.image || '',
                        video: newsData.video || '',
                        participants_list: newsData.participantsList || [],
                        staff_list: newsData.staffList || []
                    };

                    response = await fetch('api/manage-data.php?type=news', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newData)
                    });
                    result = await response.json();

                    if (result.success) {
                        const newNews = {
                            ...newsData,
                            id: result.data.id,
                            createdAt: Date.now()
                        };

                        news.push(newNews);
                        addLog('create', 'æ·»åŠ æ–°é—»', `æ·»åŠ æ–°é—»: "${newsData.title}" (æ—¶é—´: ${newsData.date} ${newsData.time})`);
                        showNotification('æ–°é—»æ·»åŠ æˆåŠŸï¼', 'success');
                    } else {
                        throw new Error(result.message || 'æ·»åŠ å¤±è´¥');
                    }
                }

                // é‡æ–°åŠ è½½æ•°æ®
                await loadData();
                updateNewsDisplay();
                updateStats();
                closeModal('newsModal');

            } catch (error) {
                console.error('ä¿å­˜æ–°é—»å¤±è´¥:', error);
                showNotification('ä¿å­˜æ–°é—»å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ç¼–è¾‘æ–‡ç« 
        function editArticle(index) {
            openArticleModal(index);
        }

        // ç¼–è¾‘æ–°é—»
        function editNews(index) {
            openNewsModal(index);
        }

        // åˆ é™¤æ–‡ç« 
        async function deleteArticle(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿ')) {
                const deletedArticle = articles[index];

                try {
                    console.log('æ­£åœ¨åˆ é™¤æ–‡ç«  ID:', deletedArticle.id);
                    const response = await fetch(`api/manage-data.php?type=articles&id=${deletedArticle.id}`, {
                        method: 'DELETE'
                    });

                    console.log('APIå“åº”çŠ¶æ€:', response.status);

                    // å…ˆè·å–åŸå§‹æ–‡æœ¬ï¼Œä»¥ä¾¿è°ƒè¯•
                    const text = await response.text();
                    console.log('APIåŸå§‹å“åº”:', text);

                    // å°è¯•è§£æJSON
                    let result;
                    try {
                        result = JSON.parse(text);
                    } catch (e) {
                        console.error('JSONè§£æå¤±è´¥ï¼ŒåŸå§‹å“åº”:', text);
                        throw new Error('æœåŠ¡å™¨è¿”å›äº†æ— æ•ˆçš„å“åº”æ ¼å¼');
                    }

                    if (result.success) {
                        articles.splice(index, 1);
                        addLog('delete', 'åˆ é™¤æ–‡ç« ', `åˆ é™¤æ–‡ç« : "${deletedArticle.title}" (åˆ†ç±»: ${deletedArticle.category})`);
                        await loadData();
                        updateArticlesDisplay();
                        updateStats();
                        showNotification('æ–‡ç« å·²åˆ é™¤ï¼', 'success');
                    } else {
                        throw new Error(result.message || 'åˆ é™¤å¤±è´¥');
                    }
                } catch (error) {
                    console.error('åˆ é™¤æ–‡ç« å¤±è´¥:', error);
                    showNotification('åˆ é™¤æ–‡ç« å¤±è´¥: ' + error.message, 'error');
                }
            }
        }

        // åˆ é™¤æ–°é—»
        async function deleteNews(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ–°é—»å—ï¼Ÿ')) {
                const deletedNews = news[index];

                try {
                    const response = await fetch(`api/manage-data.php?type=news&id=${deletedNews.id}`, {
                        method: 'DELETE'
                    });
                    const result = await response.json();

                    if (result.success) {
                        news.splice(index, 1);
                        addLog('delete', 'åˆ é™¤æ–°é—»', `åˆ é™¤æ–°é—»: "${deletedNews.title}" (æ—¶é—´: ${deletedNews.date} ${deletedNews.time})`);
                        await loadData();
                        updateNewsDisplay();
                        updateStats();
                        showNotification('æ–°é—»å·²åˆ é™¤ï¼', 'success');
                    } else {
                        throw new Error(result.message || 'åˆ é™¤å¤±è´¥');
                    }
                } catch (error) {
                    console.error('åˆ é™¤æ–°é—»å¤±è´¥:', error);
                    showNotification('åˆ é™¤æ–°é—»å¤±è´¥: ' + error.message, 'error');
                }
            }
        }

        // è®¾ç½®é»˜è®¤æ—¥æœŸ
        function setDefaultDate() {
            return new Promise((resolve) => {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('articleDate').value = today;
                document.getElementById('newsDate').value = today;

                // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œå®Œæˆ
                setTimeout(resolve, 10);
            });
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            // æƒé™æ£€æŸ¥
            if (tabName === 'logs' && !hasPermission(PERMISSIONS.SUPER_ADMIN)) {
                showNotification('æƒé™ä¸è¶³ï¼åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ—¥å¿—', 'error');
                return;
            }

            // æ´»åŠ¨å±•ç¤ºæƒé™æ£€æŸ¥
            if (tabName === 'activities' && !hasPermission(PERMISSIONS.SUPER_ADMIN)) {
                showNotification('æƒé™ä¸è¶³ï¼åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ´»åŠ¨å±•ç¤º', 'error');
                return;
            }

            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾é¡µçš„activeç±»
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.querySelectorAll('.admin-card').forEach(card => {
                card.classList.remove('active');
                card.style.display = 'none';
            });

            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾é¡µ
            const tabBtn = document.querySelector(`[data-tab="${tabName}"]`);
            const tabCard = document.getElementById(`${tabName}Tab`);

            // å¦‚æœæ˜¯æ´»åŠ¨å±•ç¤ºæ ‡ç­¾ï¼ŒåŠ è½½æ´»åŠ¨æ•°æ®
            if (tabName === 'activities') {
                loadActivitiesView();
            }

            if (tabBtn) {
                tabBtn.classList.add('active');
            }

            if (tabCard) {
                tabCard.classList.add('active');
                // ä½¿ç”¨ !important å¼ºåˆ¶æ˜¾ç¤º
                tabCard.style.cssText = 'display: block !important;';
            }

            // å¦‚æœæ˜¯æ—¥å¿—é¡µé¢ï¼Œæ¸²æŸ“æ—¥å¿—
            if (tabName === 'logs') {
                console.log('åˆ‡æ¢åˆ°æ—¥å¿—é¡µé¢');
                renderLogs();
            }

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
            updateStats();
        }

        // åŠ è½½æ´»åŠ¨å±•ç¤ºè§†å›¾
        async function loadActivitiesView() {
            const activitiesList = document.getElementById('activitiesList');

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            activitiesList.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><h3>åŠ è½½ä¸­...</h3></div>';

            try {
                console.log('å¼€å§‹åŠ è½½æ´»åŠ¨æ•°æ®...');

                // ä»APIè·å–æ•°æ®
                const response = await fetch('api/get-data.php?type=all');
                console.log('APIå“åº”çŠ¶æ€:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('è·å–åˆ°çš„åŸå§‹æ•°æ®:', result);

                // å¤„ç†ä¸åŒçš„æ•°æ®ç»“æ„
                console.log('APIè¿”å›çš„å®Œæ•´ç»“æœ:', JSON.stringify(result).substring(0, 500));

                let data = result;
                // æ£€æŸ¥æ˜¯å¦æœ‰successå­—æ®µåŒ…è£…
                if (result.success !== undefined) {
                    if (result.success && result.data) {
                        data = result.data;
                        console.log('æ•°æ®è¢«åŒ…è£…åœ¨successå­—æ®µä¸­ï¼Œå·²è§£åŒ…');
                    }
                }

                // å°è¯•ä»resultä¸­ç›´æ¥è·å–newsæ•°ç»„
                let newsData = data.news;
                if (!newsData && result.data && result.data.news) {
                    newsData = result.data.news;
                    console.log('ä»result.dataä¸­è·å–news');
                }

                console.log('å¤„ç†åçš„æ•°æ®:', data);
                console.log('æ–°é—»æ•°ç»„:', newsData);
                console.log('æ–°é—»æ•°é‡:', newsData ? newsData.length : 0);

                if (!newsData || newsData.length === 0) {
                    console.log('æ²¡æœ‰æ–°é—»æ•°æ®ï¼Œå½“å‰æ•°æ®:', data);
                    activitiesList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>æš‚æ— æ´»åŠ¨</h3>
                            <p>åœ¨"æ–°é—»ç®¡ç†"ä¸­æ·»åŠ æ´»åŠ¨</p>
                        </div>
                    `;
                    return;
                }

                // æ˜¾ç¤ºæ‰€æœ‰æ–°é—»ï¼ˆä¸è¿‡æ»¤ï¼‰
                const activities = newsData;
                console.log('æ´»åŠ¨æ•°é‡ï¼ˆæ˜¾ç¤ºå…¨éƒ¨ï¼‰:', activities.length);

                if (activities.length === 0) {
                    console.log('æ´»åŠ¨åˆ—è¡¨ä¸ºç©º');
                    activitiesList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>æš‚æ— æ´»åŠ¨</h3>
                            <p>åœ¨"æ–°é—»ç®¡ç†"ä¸­æ·»åŠ æ´»åŠ¨</p>
                        </div>
                    `;
                    return;
                }

                // æ¸²æŸ“æ´»åŠ¨å¡ç‰‡
                console.log('å¼€å§‹æ¸²æŸ“æ´»åŠ¨å¡ç‰‡ï¼Œå…±', activities.length, 'ä¸ªæ´»åŠ¨');
                activitiesList.innerHTML = activities.map(activity => {
                    console.log('æ¸²æŸ“æ´»åŠ¨:', activity.title, 'ID:', activity.id);

                    // ä¼˜å…ˆä½¿ç”¨å°é¢å›¾
                    let imageUrl = '';
                    if (activity.cover_image) {
                        imageUrl = activity.cover_image;
                    } else if (activity.coverImage) {
                        imageUrl = activity.coverImage;
                    } else if (activity.image) {
                        if (Array.isArray(activity.image) && activity.image.length > 0) {
                            imageUrl = activity.image[0];
                        } else if (typeof activity.image === 'string') {
                            imageUrl = activity.image;
                        }
                    }

                    console.log('æ´»åŠ¨å›¾ç‰‡URL:', imageUrl);

                    return `
                        <div class="activity-card-admin" style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'" onclick="window.open('admin-activity-detail.html?id=${activity.id}', '_blank')">
                            ${imageUrl ? `<img src="${imageUrl}" alt="${activity.title}" style="width: 100%; height: 200px; object-fit: cover;" onerror="console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', '${imageUrl}')">` : ''}
                            <div style="padding: 20px;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                    <span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 500;">${activity.category || 'æ´»åŠ¨æ–°é—»'}</span>
                                    <span style="color: #666; font-size: 0.85rem;">${activity.date} ${activity.time || ''}</span>
                                </div>
                                <h3 style="margin: 0 0 10px 0; color: #2D3748; font-size: 1.1rem; font-weight: 600; line-height: 1.4;">${activity.title}</h3>
                                ${activity.subtitle ? `<p style="margin: 0 0 10px 0; color: #4A5568; font-size: 0.9rem; line-height: 1.5;">${activity.subtitle}</p>` : ''}
                                <div style="display: flex; flex-direction: column; gap: 6px; margin-top: 12px;">
                                    <div style="display: flex; align-items: center; gap: 6px; color: #718096; font-size: 0.85rem;">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span>${activity.location || 'éŸ©å›½ä¸­å¿ƒ'}</span>
                                    </div>
                                    ${activity.organizer ? `
                                    <div style="display: flex; align-items: center; gap: 6px; color: #718096; font-size: 0.85rem;">
                                        <i class="fas fa-users"></i>
                                        <span>${activity.organizer}</span>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                console.log('æ´»åŠ¨æ¸²æŸ“å®Œæˆ');

            } catch (error) {
                console.error('åŠ è½½æ´»åŠ¨å¤±è´¥:', error);
                activitiesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-circle"></i>
                        <h3>åŠ è½½å¤±è´¥</h3>
                        <p>${error.message}</p>
                        <p style="margin-top: 10px; font-size: 0.85rem; color: #999;">è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</p>
                    </div>
                `;
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            document.body.appendChild(notification);

            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­ï¼ˆå·²ç¦ç”¨ï¼Œé˜²æ­¢æ„å¤–å…³é—­ï¼‰
        document.addEventListener('click', function (e) {
            // ç¦ç”¨æ‰€æœ‰æ¨¡æ€æ¡†çš„ç‚¹å‡»å¤–éƒ¨å…³é—­åŠŸèƒ½ï¼Œåªèƒ½é€šè¿‡å–æ¶ˆæŒ‰é’®å…³é—­
            // è¿™æ ·å¯ä»¥é˜²æ­¢ç”¨æˆ·åœ¨å¡«å†™è¡¨å•æ—¶æ„å¤–å…³é—­æ¨¡æ€æ¡†
        });

        // ESCé”®å…³é—­æ¨¡æ€æ¡†ï¼ˆå·²ç¦ç”¨ï¼Œé˜²æ­¢æ„å¤–å…³é—­ï¼‰
        document.addEventListener('keydown', function (e) {
            // ç¦ç”¨æ‰€æœ‰æ¨¡æ€æ¡†çš„ESCé”®å…³é—­åŠŸèƒ½ï¼Œåªèƒ½é€šè¿‡å–æ¶ˆæŒ‰é’®å…³é—­
            // è¿™æ ·å¯ä»¥é˜²æ­¢ç”¨æˆ·åœ¨å¡«å†™è¡¨å•æ—¶æ„å¤–å…³é—­æ¨¡æ€æ¡†
        });
    </script>
</body>

</html>